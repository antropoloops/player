{"ast":null,"code":"import _slicedToArray from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { getActiveAudioContext } from \"../../player\";\nimport { AudioContextEngine } from \"../../player/AudioContextEngine\";\nimport { AudiosetControl, EmptyControlState } from \"../../player/Control\";\nimport { ResourceLoader } from \"../../player/ResourceLoader\";\nimport { Sampler } from \"../../player/Sampler\";\nexport function usePlayer(audioset) {\n  const visualsRef = useRef(null);\n\n  const _useState = useState(null),\n        _useState2 = _slicedToArray(_useState, 2),\n        control = _useState2[0],\n        setControl = _useState2[1];\n\n  const _useState3 = useState(EmptyControlState),\n        _useState4 = _slicedToArray(_useState3, 2),\n        state = _useState4[0],\n        setState = _useState4[1];\n\n  useEffect(() => {\n    let cancelled = false;\n    let splr;\n    let vsls;\n\n    async function createPlayer() {\n      const loader = new ResourceLoader(audioset, status => {// TODO: set clip enabled\n      });\n      loader.preload();\n\n      const _ref = await import(\"../../visuals/index\"),\n            VisualControl = _ref.VisualControl;\n\n      const ctx = await getActiveAudioContext();\n\n      if (cancelled) {\n        return;\n      }\n\n      loader.load();\n      const sampler = splr = createSampler(audioset, ctx, loader);\n      const visuals = vsls = new VisualControl(audioset, visualsRef.current);\n      const ctl = new AudiosetControl(audioset, {\n        onControlStateChanged: newState => {\n          setState(newState);\n        },\n        onControlCommand: command => {\n          sampler.run(command);\n          visuals.run(command);\n        }\n      });\n      setControl(ctl);\n      setState(ctl.getState());\n    }\n\n    createPlayer();\n    return () => {\n      var _vsls, _splr;\n\n      cancelled = true;\n      (_vsls = vsls) === null || _vsls === void 0 ? void 0 : _vsls.detach();\n      (_splr = splr) === null || _splr === void 0 ? void 0 : _splr.dispose();\n    };\n  }, [audioset]);\n  return {\n    visualsRef,\n    control,\n    state\n  };\n}\n\nfunction createSampler(audioset, ctx, buffers) {\n  const audio = new AudioContextEngine(ctx);\n  const sampler = new Sampler(audioset, buffers, audio);\n  return sampler;\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/ui/Player/usePlayer.tsx"],"names":["useEffect","useRef","useState","getActiveAudioContext","AudioContextEngine","AudiosetControl","EmptyControlState","ResourceLoader","Sampler","usePlayer","audioset","visualsRef","control","setControl","state","setState","cancelled","splr","vsls","createPlayer","loader","status","preload","VisualControl","ctx","load","sampler","createSampler","visuals","current","ctl","onControlStateChanged","newState","onControlCommand","command","run","getState","detach","dispose","buffers","audio"],"mappings":";AAAA,SAASA,SAAT,EAAoBC,MAApB,EAA4BC,QAA5B,QAA4C,OAA5C;AAGA,SAASC,qBAAT,QAAsC,cAAtC;AACA,SAASC,kBAAT,QAAmC,iCAAnC;AACA,SACEC,eADF,EAGEC,iBAHF,QAKO,sBALP;AAMA,SAASC,cAAT,QAA+B,6BAA/B;AACA,SAASC,OAAT,QAAwB,sBAAxB;AAEA,OAAO,SAASC,SAAT,CAAmBC,QAAnB,EAAuC;AAC5C,QAAMC,UAAU,GAAGV,MAAM,CAAiB,IAAjB,CAAzB;;AAD4C,oBAEdC,QAAQ,CAAuB,IAAvB,CAFM;AAAA;AAAA,QAErCU,OAFqC;AAAA,QAE5BC,UAF4B;;AAAA,qBAGlBX,QAAQ,CAACI,iBAAD,CAHU;AAAA;AAAA,QAGrCQ,KAHqC;AAAA,QAG9BC,QAH8B;;AAK5Cf,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIgB,SAAS,GAAG,KAAhB;AACA,QAAIC,IAAJ;AACA,QAAIC,IAAJ;;AAEA,mBAAeC,YAAf,GAA8B;AAC5B,YAAMC,MAAM,GAAG,IAAIb,cAAJ,CAAmBG,QAAnB,EAA6BW,MAAM,IAAI,CACpD;AACD,OAFc,CAAf;AAGAD,MAAAA,MAAM,CAACE,OAAP;;AAJ4B,mBAMF,MAAM,OAAO,qBAAP,CANJ;AAAA,YAMpBC,aANoB,QAMpBA,aANoB;;AAO5B,YAAMC,GAAG,GAAG,MAAMrB,qBAAqB,EAAvC;;AAEA,UAAIa,SAAJ,EAAe;AACb;AACD;;AAEDI,MAAAA,MAAM,CAACK,IAAP;AACA,YAAMC,OAAO,GAAIT,IAAI,GAAGU,aAAa,CAACjB,QAAD,EAAWc,GAAX,EAAgBJ,MAAhB,CAArC;AACA,YAAMQ,OAAO,GAAIV,IAAI,GAAG,IAAIK,aAAJ,CAAkBb,QAAlB,EAA4BC,UAAU,CAACkB,OAAvC,CAAxB;AAEA,YAAMC,GAAG,GAAG,IAAIzB,eAAJ,CAAoBK,QAApB,EAA8B;AACxCqB,QAAAA,qBAAqB,EAAEC,QAAQ,IAAI;AACjCjB,UAAAA,QAAQ,CAACiB,QAAD,CAAR;AACD,SAHuC;AAIxCC,QAAAA,gBAAgB,EAAEC,OAAO,IAAI;AAC3BR,UAAAA,OAAO,CAACS,GAAR,CAAYD,OAAZ;AACAN,UAAAA,OAAO,CAACO,GAAR,CAAYD,OAAZ;AACD;AAPuC,OAA9B,CAAZ;AASArB,MAAAA,UAAU,CAACiB,GAAD,CAAV;AACAf,MAAAA,QAAQ,CAACe,GAAG,CAACM,QAAJ,EAAD,CAAR;AACD;;AAEDjB,IAAAA,YAAY;AACZ,WAAO,MAAM;AAAA;;AACXH,MAAAA,SAAS,GAAG,IAAZ;AACA,eAAAE,IAAI,UAAJ,sCAAMmB,MAAN;AACA,eAAApB,IAAI,UAAJ,sCAAMqB,OAAN;AACD,KAJD;AAKD,GAzCQ,EAyCN,CAAC5B,QAAD,CAzCM,CAAT;AA2CA,SAAO;AAAEC,IAAAA,UAAF;AAAcC,IAAAA,OAAd;AAAuBE,IAAAA;AAAvB,GAAP;AACD;;AAED,SAASa,aAAT,CACEjB,QADF,EAEEc,GAFF,EAGEe,OAHF,EAIW;AACT,QAAMC,KAAK,GAAG,IAAIpC,kBAAJ,CAAuBoB,GAAvB,CAAd;AACA,QAAME,OAAO,GAAG,IAAIlB,OAAJ,CAAYE,QAAZ,EAAsB6B,OAAtB,EAA+BC,KAA/B,CAAhB;AACA,SAAOd,OAAP;AACD","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\nimport { IAudioContext } from \"standardized-audio-context\";\nimport { Audioset } from \"../../audioset\";\nimport { getActiveAudioContext } from \"../../player\";\nimport { AudioContextEngine } from \"../../player/AudioContextEngine\";\nimport {\n  AudiosetControl,\n  ControlCommand,\n  EmptyControlState,\n  PlayerControl,\n} from \"../../player/Control\";\nimport { ResourceLoader } from \"../../player/ResourceLoader\";\nimport { Sampler } from \"../../player/Sampler\";\n\nexport function usePlayer(audioset: Audioset) {\n  const visualsRef = useRef<HTMLDivElement>(null);\n  const [control, setControl] = useState<PlayerControl | null>(null);\n  const [state, setState] = useState(EmptyControlState);\n\n  useEffect(() => {\n    let cancelled = false;\n    let splr: Sampler | undefined;\n    let vsls: VisualControl | undefined;\n\n    async function createPlayer() {\n      const loader = new ResourceLoader(audioset, status => {\n        // TODO: set clip enabled\n      });\n      loader.preload();\n\n      const { VisualControl } = await import(\"../../visuals/index\");\n      const ctx = await getActiveAudioContext();\n\n      if (cancelled) {\n        return;\n      }\n\n      loader.load();\n      const sampler = (splr = createSampler(audioset, ctx, loader));\n      const visuals = (vsls = new VisualControl(audioset, visualsRef.current));\n\n      const ctl = new AudiosetControl(audioset, {\n        onControlStateChanged: newState => {\n          setState(newState);\n        },\n        onControlCommand: command => {\n          sampler.run(command);\n          visuals.run(command);\n        },\n      });\n      setControl(ctl);\n      setState(ctl.getState());\n    }\n\n    createPlayer();\n    return () => {\n      cancelled = true;\n      vsls?.detach();\n      splr?.dispose();\n    };\n  }, [audioset]);\n\n  return { visualsRef, control, state };\n}\n\nfunction createSampler(\n  audioset: Audioset,\n  ctx: IAudioContext,\n  buffers: ResourceLoader,\n): Sampler {\n  const audio = new AudioContextEngine(ctx);\n  const sampler = new Sampler(audioset, buffers, audio);\n  return sampler;\n}\n"]},"metadata":{},"sourceType":"module"}