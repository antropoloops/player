{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import debug from\"debug\";var context;var log=debug(\"atpls:context\");/**\n * @see https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio\n */export function getAudioContext(){return _regeneratorRuntime.async(function getAudioContext$(_context){while(1){switch(_context.prev=_context.next){case 0:context=context||createAudioContext();if(!(context.state!==\"running\"&&context.resume)){_context.next=6;break;}log(\"waiting for context...\");return _context.abrupt(\"return\",context.resume().then(function(){return startAudioContext(context);}));case 6:return _context.abrupt(\"return\",context);case 7:case\"end\":return _context.stop();}}});}function createAudioContext(){log(\"create context\");var ctx=new(window.AudioContext||window.webkitAudioContext)();return ctx;}function startAudioContext(ctx){log(\"start context\");// iOS hack. See https://github.com/tambien/StartAudioContext/blob/master/StartAudioContext.js\nvar buffer=ctx.createBuffer(1,1,ctx.sampleRate);var source=ctx.createBufferSource();source.buffer=buffer;source.connect(ctx.destination);source.start(0);return ctx;}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/player/AudioContext.ts"],"names":["debug","context","log","getAudioContext","createAudioContext","state","resume","then","startAudioContext","ctx","window","AudioContext","webkitAudioContext","buffer","createBuffer","sampleRate","source","createBufferSource","connect","destination","start"],"mappings":"mJAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CAEA,GAAIC,CAAAA,OAAJ,CAEA,GAAMC,CAAAA,GAAG,CAAGF,KAAK,CAAC,eAAD,CAAjB,CAEA;;GAGA,MAAO,SAAeG,CAAAA,eAAf,4HACLF,OAAO,CAAGA,OAAO,EAAIG,kBAAkB,EAAvC,CADK,KAGDH,OAAO,CAACI,KAAR,GAAkB,SAAlB,EAA+BJ,OAAO,CAACK,MAHtC,0BAIHJ,GAAG,CAAC,wBAAD,CAAH,CAJG,gCAKID,OAAO,CACXK,MADI,GAEJC,IAFI,CAEC,iBAAMC,CAAAA,iBAAiB,CAACP,OAAD,CAAvB,EAFD,CALJ,yCASIA,OATJ,gDAaP,QAASG,CAAAA,kBAAT,EAA4C,CAC1CF,GAAG,CAAC,gBAAD,CAAH,CACA,GAAMO,CAAAA,GAAG,CAAG,IAAMC,MAAD,CAAgBC,YAAhB,EACdD,MAAD,CAAgBE,kBADN,GAAZ,CAEA,MAAOH,CAAAA,GAAP,CACD,CAED,QAASD,CAAAA,iBAAT,CAA2BC,GAA3B,CAA4D,CAC1DP,GAAG,CAAC,eAAD,CAAH,CACA;AACA,GAAMW,CAAAA,MAAM,CAAGJ,GAAG,CAACK,YAAJ,CAAiB,CAAjB,CAAoB,CAApB,CAAuBL,GAAG,CAACM,UAA3B,CAAf,CACA,GAAMC,CAAAA,MAAM,CAAGP,GAAG,CAACQ,kBAAJ,EAAf,CACAD,MAAM,CAACH,MAAP,CAAgBA,MAAhB,CACAG,MAAM,CAACE,OAAP,CAAeT,GAAG,CAACU,WAAnB,EACAH,MAAM,CAACI,KAAP,CAAa,CAAb,EACA,MAAOX,CAAAA,GAAP,CACD","sourcesContent":["import debug from \"debug\";\n\nlet context: AudioContext | undefined;\n\nconst log = debug(\"atpls:context\");\n\n/**\n * @see https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio\n */\nexport async function getAudioContext(): Promise<AudioContext> {\n  context = context || createAudioContext();\n\n  if (context.state !== \"running\" && context.resume) {\n    log(\"waiting for context...\");\n    return context\n      .resume()\n      .then(() => startAudioContext(context as AudioContext));\n  } else {\n    return context;\n  }\n}\n\nfunction createAudioContext(): AudioContext {\n  log(\"create context\");\n  const ctx = new ((window as any).AudioContext ||\n    (window as any).webkitAudioContext)() as AudioContext;\n  return ctx;\n}\n\nfunction startAudioContext(ctx: AudioContext): AudioContext {\n  log(\"start context\");\n  // iOS hack. See https://github.com/tambien/StartAudioContext/blob/master/StartAudioContext.js\n  const buffer = ctx.createBuffer(1, 1, ctx.sampleRate);\n  const source = ctx.createBufferSource();\n  source.buffer = buffer;\n  source.connect(ctx.destination);\n  source.start(0);\n  return ctx;\n}\n"]},"metadata":{},"sourceType":"module"}