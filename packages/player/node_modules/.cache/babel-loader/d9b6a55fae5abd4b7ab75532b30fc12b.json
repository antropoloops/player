{"ast":null,"code":"// TODO: abstract (LoadPending, LoadProgress, LoadReady, LoadError)\nexport class AudiosetLoader {\n  constructor(onAudiosetStatusChange) {\n    this.onAudiosetStatusChange = onAudiosetStatusChange;\n    this.status = {\n      stage: \"pending\"\n    };\n\n    this.fetch = () => Promise.reject();\n  }\n\n  loadAudioset(audiosetId) {\n    this.setStatus({\n      stage: \"loading\",\n      audiosetId\n    });\n    return this.fetch(audiosetId).then(audioset => this.setStatus({\n      stage: \"ready\",\n      audioset\n    })).catch(error => this.setStatus({\n      stage: \"error\",\n      error\n    }));\n  }\n\n  setStatus(status) {\n    this.status = status;\n    this.onAudiosetStatusChange(status);\n    return status;\n  }\n\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/audioset/AudiosetLoader.ts"],"names":["AudiosetLoader","constructor","onAudiosetStatusChange","status","stage","fetch","Promise","reject","loadAudioset","audiosetId","setStatus","then","audioset","catch","error"],"mappings":"AAEA;AA4BA,OAAO,MAAMA,cAAN,CAAqB;AAG1BC,EAAAA,WAAW,CAASC,sBAAT,EAA+C;AAAA,SAAtCA,sBAAsC,GAAtCA,sBAAsC;AAAA,SAFnDC,MAEmD,GAFtB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAEsB;;AAAA,SACnDC,KADmD,GAC5B,MAAMC,OAAO,CAACC,MAAR,EADsB;AAAE;;AAGrDC,EAAAA,YAAP,CAAoBC,UAApB,EAAqE;AACnE,SAAKC,SAAL,CAAe;AAAEN,MAAAA,KAAK,EAAE,SAAT;AAAoBK,MAAAA;AAApB,KAAf;AACA,WAAO,KAAKJ,KAAL,CAAWI,UAAX,EACJE,IADI,CACCC,QAAQ,IAAI,KAAKF,SAAL,CAAe;AAAEN,MAAAA,KAAK,EAAE,OAAT;AAAkBQ,MAAAA;AAAlB,KAAf,CADb,EAEJC,KAFI,CAEEC,KAAK,IAAI,KAAKJ,SAAL,CAAe;AAAEN,MAAAA,KAAK,EAAE,OAAT;AAAkBU,MAAAA;AAAlB,KAAf,CAFX,CAAP;AAGD;;AAEOJ,EAAAA,SAAR,CAAkBP,MAAlB,EAA8C;AAC5C,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKD,sBAAL,CAA4BC,MAA5B;AACA,WAAOA,MAAP;AACD;;AAjByB","sourcesContent":["import { AudiosetBundle } from \".\";\n\n// TODO: abstract (LoadPending, LoadProgress, LoadReady, LoadError)\ninterface LoadPending {\n  readonly stage: \"pending\";\n}\ninterface LoadingAudioset {\n  readonly stage: \"loading\";\n  readonly audiosetId: string;\n}\ninterface AudiosetLoaded {\n  readonly stage: \"ready\";\n  readonly audioset: AudiosetBundle;\n}\ninterface AudiosetLoadError {\n  readonly stage: \"error\";\n  readonly error: any;\n}\n\nexport type AudiosetLoadStatus =\n  | LoadStatus<AudiosetBundle, string>\n  | LoadPending\n  | LoadingAudioset\n  | AudiosetLoaded\n  | AudiosetLoadError;\n\nexport type FetchAudioset = (id: string) => Promise<AudiosetBundle>;\n\ntype LoadListener = (status: AudiosetLoadStatus) => void;\n\nexport class AudiosetLoader {\n  public status: AudiosetLoadStatus = { stage: \"pending\" };\n\n  constructor(private onAudiosetStatusChange: LoadListener) {}\n  public fetch: FetchAudioset = () => Promise.reject();\n\n  public loadAudioset(audiosetId: string): Promise<AudiosetLoadStatus> {\n    this.setStatus({ stage: \"loading\", audiosetId });\n    return this.fetch(audiosetId)\n      .then(audioset => this.setStatus({ stage: \"ready\", audioset }))\n      .catch(error => this.setStatus({ stage: \"error\", error }));\n  }\n\n  private setStatus(status: AudiosetLoadStatus) {\n    this.status = status;\n    this.onAudiosetStatusChange(status);\n    return status;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}