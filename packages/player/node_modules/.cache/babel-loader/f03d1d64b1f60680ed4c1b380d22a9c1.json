{"ast":null,"code":"import * as d3 from \"d3\"; // Number of slices in a circle\n\nconst NUMSLICES = 36; // Scale. Get the degrees for a specific slice\n\nconst degreesFromSlice = d3.scaleLinear().range([0, 360]) // working in degrees\n.domain([0, NUMSLICES]);\nexport default function drawCircle(parent, width, cx, cy, params) {\n  const duration = params.duration,\n        trackVolume = params.trackVolume,\n        trackColor = params.trackColor;\n  const circlesGroup = parent.append(\"g\").attr(\"class\", \"circleGroup\").attr(\"transform\", \"translate(\".concat(cx, \", \").concat(cy, \")\")); // We need to group again, so that the circle turns in its location\n\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\"); // Arc generator\n\n  const arc = d3.arc(); // Create outerArcs data\n\n  const outerArcs = createOuterArcs(NUMSLICES, width, trackVolume); // Draw outerArcs\n\n  circle.selectAll(\".outerArcs\").data(outerArcs).enter().append(\"path\").attr(\"class\", \"outerArcs\").attr(\"d\", arc).style(\"fill\", trackColor).style(\"opacity\", (d, i) => {\n    return 0.3 / NUMSLICES * i;\n  }); // Create innerArcs data\n\n  const innerArcs = createInnerArcs(NUMSLICES, width, trackVolume); // Draw innerArcs\n\n  circle.selectAll(\".innerArcs\").data(innerArcs).enter().append(\"path\").attr(\"class\", \"innerArcs\").attr(\"d\", arc).style(\"fill\", trackColor).style(\"opacity\", (d, i) => {\n    return 1 / NUMSLICES * i;\n  });\n  circle.append(\"line\").attr(\"x1\", 0).attr(\"y1\", 0).attr(\"x2\", 0).attr(\"y2\", -(width / 30 * trackVolume + width / 350)).style(\"stroke\", trackColor).style(\"stroke-width\", 1.5); // Add animation to make the circle turn\n\n  const turnTimer = d3.timer(turn);\n\n  function turn(elapsed) {\n    const elapsedSeconds = elapsed / 1000 % duration;\n    const turnScale = d3.scaleLinear().range([1, 0]).domain([0, duration]);\n    circle.style(\"transform\", \"rotate(\".concat(-turnScale(elapsedSeconds), \"turn)\"));\n\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(NUMSLICES, width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(NUMSLICES, width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume * 2\n    };\n  });\n} // Transform degrees into radians\n\n\nfunction deg2rad(degrees) {\n  return degrees * (Math.PI / 180);\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/visuals/drawCircle.js"],"names":["d3","NUMSLICES","degreesFromSlice","scaleLinear","range","domain","drawCircle","parent","width","cx","cy","params","duration","trackVolume","trackColor","circlesGroup","append","attr","circle","arc","outerArcs","createOuterArcs","selectAll","data","enter","style","d","i","innerArcs","createInnerArcs","turnTimer","timer","turn","elapsed","elapsedSeconds","turnScale","select","empty","stop","map","startAngle","deg2rad","endAngle","innerRadius","outerRadius","degrees","Math","PI"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\n\n// Number of slices in a circle\nconst NUMSLICES = 36;\n\n// Scale. Get the degrees for a specific slice\nconst degreesFromSlice = d3\n  .scaleLinear()\n  .range([0, 360]) // working in degrees\n  .domain([0, NUMSLICES]);\n\nexport default function drawCircle(parent, width, cx, cy, params) {\n  const { duration, trackVolume, trackColor } = params;\n  const circlesGroup = parent\n    .append(\"g\")\n    .attr(\"class\", \"circleGroup\")\n    .attr(\"transform\", `translate(${cx}, ${cy})`);\n\n  // We need to group again, so that the circle turns in its location\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\");\n\n  // Arc generator\n  const arc = d3.arc();\n\n  // Create outerArcs data\n  const outerArcs = createOuterArcs(NUMSLICES, width, trackVolume);\n\n  // Draw outerArcs\n  circle\n    .selectAll(\".outerArcs\")\n    .data(outerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"outerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (0.3 / NUMSLICES) * i;\n    });\n\n  // Create innerArcs data\n  const innerArcs = createInnerArcs(NUMSLICES, width, trackVolume);\n\n  // Draw innerArcs\n  circle\n    .selectAll(\".innerArcs\")\n    .data(innerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"innerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return (1 / NUMSLICES) * i;\n    });\n\n  circle\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", -((width / 30) * trackVolume + width / 350))\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-width\", 1.5);\n\n  // Add animation to make the circle turn\n  const turnTimer = d3.timer(turn);\n  function turn(elapsed) {\n    const elapsedSeconds = (elapsed / 1000) % duration;\n    const turnScale = d3\n      .scaleLinear()\n      .range([1, 0])\n      .domain([0, duration]);\n    circle.style(\"transform\", `rotate(${-turnScale(elapsedSeconds)}turn)`);\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(NUMSLICES, width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === NUMSLICES - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (width / 30) * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(NUMSLICES, width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle:\n        i === NUMSLICES - 1\n          ? deg2rad(degreesFromSlice(d + 1))\n          : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: (width / 30) * trackVolume * 2\n    };\n  });\n}\n\n// Transform degrees into radians\nfunction deg2rad(degrees) {\n  return degrees * (Math.PI / 180);\n}\n"]},"metadata":{},"sourceType":"module"}