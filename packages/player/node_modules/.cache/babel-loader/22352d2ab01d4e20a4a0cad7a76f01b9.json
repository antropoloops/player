{"ast":null,"code":"import debug from\"debug\";import{isAudioset}from\"./Audioset\";import{isBundle}from\"./Bundle\";var log=debug(\"atpls:audioset\");var capitalize=function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1);};export function createAudioset(bundle){if(!isBundle(bundle)){log(\"Invalid format %o\",bundle);throw Error(\"Invalida Audioset format\");}if(isAudioset(bundle)){migrateOrDerive(bundle);createIndices(bundle);}return bundle;}function migrateOrDerive(audioset){var bpm=audioset.audio.bpm||120;audioset.clips.forEach(function(clip){clip.name=clip.name||capitalize(clip.id);clip.artist=clip.artist||\"\";clip.place=clip.place||\"\";clip.country=clip.country||\"\";clip.audio.volume=clip.audio.volume||0.7;clip.audio.durationSeconds=60*clip.audio.beats/bpm;});}function createIndices(audioset){var index={clipById:{},trackById:{},clipIdsOfTrack:{},trackIdOfClip:{}};audioset.clips.forEach(function(clip){index.clipById[clip.id]=clip;index.trackIdOfClip[clip.id]=clip.trackId;});audioset.tracks.forEach(function(track){index.trackById[track.id]=track;index.clipIdsOfTrack[track.id]=track.clipIds;});audioset.index=index;}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/audioset/createAudioset.ts"],"names":["debug","isAudioset","isBundle","log","capitalize","str","charAt","toUpperCase","slice","createAudioset","bundle","Error","migrateOrDerive","createIndices","audioset","bpm","audio","clips","forEach","clip","name","id","artist","place","country","volume","durationSeconds","beats","index","clipById","trackById","clipIdsOfTrack","trackIdOfClip","trackId","tracks","track","clipIds"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAoCC,UAApC,KAAsD,YAAtD,CACA,OAAiBC,QAAjB,KAAiC,UAAjC,CAEA,GAAMC,CAAAA,GAAG,CAAGH,KAAK,CAAC,gBAAD,CAAjB,CACA,GAAMI,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,GAAD,QAAiBA,CAAAA,GAAG,CAACC,MAAJ,CAAW,CAAX,EAAcC,WAAd,GAA8BF,GAAG,CAACG,KAAJ,CAAU,CAAV,CAA/C,EAAnB,CAEA,MAAO,SAASC,CAAAA,cAAT,CAAwBC,MAAxB,CAA6C,CAClD,GAAI,CAACR,QAAQ,CAACQ,MAAD,CAAb,CAAuB,CACrBP,GAAG,CAAC,mBAAD,CAAsBO,MAAtB,CAAH,CACA,KAAMC,CAAAA,KAAK,CAAC,0BAAD,CAAX,CACD,CACD,GAAIV,UAAU,CAACS,MAAD,CAAd,CAAwB,CACtBE,eAAe,CAACF,MAAD,CAAf,CACAG,aAAa,CAACH,MAAD,CAAb,CACD,CACD,MAAOA,CAAAA,MAAP,CACD,CAED,QAASE,CAAAA,eAAT,CAAyBE,QAAzB,CAA6C,CAC3C,GAAMC,CAAAA,GAAG,CAAGD,QAAQ,CAACE,KAAT,CAAeD,GAAf,EAAsB,GAAlC,CACAD,QAAQ,CAACG,KAAT,CAAeC,OAAf,CAAuB,SAAAC,IAAI,CAAI,CAC7BA,IAAI,CAACC,IAAL,CAAYD,IAAI,CAACC,IAAL,EAAahB,UAAU,CAACe,IAAI,CAACE,EAAN,CAAnC,CACAF,IAAI,CAACG,MAAL,CAAcH,IAAI,CAACG,MAAL,EAAe,EAA7B,CACAH,IAAI,CAACI,KAAL,CAAaJ,IAAI,CAACI,KAAL,EAAc,EAA3B,CACAJ,IAAI,CAACK,OAAL,CAAeL,IAAI,CAACK,OAAL,EAAgB,EAA/B,CACAL,IAAI,CAACH,KAAL,CAAWS,MAAX,CAAoBN,IAAI,CAACH,KAAL,CAAWS,MAAX,EAAqB,GAAzC,CACAN,IAAI,CAACH,KAAL,CAAWU,eAAX,CAA8B,GAAKP,IAAI,CAACH,KAAL,CAAWW,KAAjB,CAA0BZ,GAAvD,CACD,CAPD,EAQD,CAED,QAASF,CAAAA,aAAT,CAAuBC,QAAvB,CAA2C,CACzC,GAAMc,CAAAA,KAAsB,CAAG,CAC7BC,QAAQ,CAAE,EADmB,CAE7BC,SAAS,CAAE,EAFkB,CAG7BC,cAAc,CAAE,EAHa,CAI7BC,aAAa,CAAE,EAJc,CAA/B,CAMAlB,QAAQ,CAACG,KAAT,CAAeC,OAAf,CAAuB,SAAAC,IAAI,CAAI,CAC7BS,KAAK,CAACC,QAAN,CAAeV,IAAI,CAACE,EAApB,EAA0BF,IAA1B,CACAS,KAAK,CAACI,aAAN,CAAoBb,IAAI,CAACE,EAAzB,EAA+BF,IAAI,CAACc,OAApC,CACD,CAHD,EAIAnB,QAAQ,CAACoB,MAAT,CAAgBhB,OAAhB,CAAwB,SAAAiB,KAAK,CAAI,CAC/BP,KAAK,CAACE,SAAN,CAAgBK,KAAK,CAACd,EAAtB,EAA4Bc,KAA5B,CACAP,KAAK,CAACG,cAAN,CAAqBI,KAAK,CAACd,EAA3B,EAAiCc,KAAK,CAACC,OAAvC,CACD,CAHD,EAIAtB,QAAQ,CAACc,KAAT,CAAiBA,KAAjB,CACD","sourcesContent":["import debug from \"debug\";\nimport { Audioset, AudiosetIndexes, isAudioset } from \"./Audioset\";\nimport { Bundle, isBundle } from \"./Bundle\";\n\nconst log = debug(\"atpls:audioset\");\nconst capitalize = (str: string) => str.charAt(0).toUpperCase() + str.slice(1);\n\nexport function createAudioset(bundle: any): Bundle {\n  if (!isBundle(bundle)) {\n    log(\"Invalid format %o\", bundle);\n    throw Error(\"Invalida Audioset format\");\n  }\n  if (isAudioset(bundle)) {\n    migrateOrDerive(bundle);\n    createIndices(bundle);\n  }\n  return bundle;\n}\n\nfunction migrateOrDerive(audioset: Audioset) {\n  const bpm = audioset.audio.bpm || 120;\n  audioset.clips.forEach(clip => {\n    clip.name = clip.name || capitalize(clip.id);\n    clip.artist = clip.artist || \"\";\n    clip.place = clip.place || \"\";\n    clip.country = clip.country || \"\";\n    clip.audio.volume = clip.audio.volume || 0.7;\n    clip.audio.durationSeconds = (60 * clip.audio.beats) / bpm;\n  });\n}\n\nfunction createIndices(audioset: Audioset) {\n  const index: AudiosetIndexes = {\n    clipById: {},\n    trackById: {},\n    clipIdsOfTrack: {},\n    trackIdOfClip: {},\n  };\n  audioset.clips.forEach(clip => {\n    index.clipById[clip.id] = clip;\n    index.trackIdOfClip[clip.id] = clip.trackId;\n  });\n  audioset.tracks.forEach(track => {\n    index.trackById[track.id] = track;\n    index.clipIdsOfTrack[track.id] = track.clipIds;\n  });\n  audioset.index = index;\n}\n"]},"metadata":{},"sourceType":"module"}