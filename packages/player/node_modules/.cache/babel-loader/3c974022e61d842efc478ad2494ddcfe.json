{"ast":null,"code":"import { testClonabilityOfAudioWorkletNodeOptions } from '../helpers/test-clonability-of-audio-worklet-node-options';\nexport const createNativeAudioWorkletNodeFactory = (createInvalidStateError, createNativeAudioNode, createNativeAudioWorkletNodeFaker, createNotSupportedError, isNativeOfflineAudioContext) => {\n  return (nativeContext, baseLatency, nativeAudioWorkletNodeConstructor, name, processorConstructor, options) => {\n    if (nativeAudioWorkletNodeConstructor !== null) {\n      try {\n        // Bug #86: Chrome & Opera do not invoke the process() function if the corresponding AudioWorkletNode has no output.\n        const nativeAudioWorkletNode = createNativeAudioNode(nativeContext, ntvCntxt => {\n          return isNativeOfflineAudioContext(ntvCntxt) && options.numberOfInputs !== 0 && options.numberOfOutputs === 0 ? new nativeAudioWorkletNodeConstructor(ntvCntxt, name, { ...options,\n            numberOfOutputs: 1,\n            outputChannelCount: [1],\n            parameterData: { ...options.parameterData,\n              hasNoOutput: 1\n            }\n          }) : new nativeAudioWorkletNodeConstructor(ntvCntxt, name, options);\n        });\n        const patchedEventListeners = new Map(); // tslint:disable-line:max-line-length\n\n        let onprocessorerror = null;\n        Object.defineProperties(nativeAudioWorkletNode, {\n          /*\n           * Bug #61: Overwriting the property accessors for channelCount and channelCountMode is necessary as long as some\n           * browsers have no native implementation to achieve a consistent behavior.\n           */\n          channelCount: {\n            get: () => options.channelCount,\n            set: () => {\n              throw createInvalidStateError();\n            }\n          },\n          channelCountMode: {\n            get: () => 'explicit',\n            set: () => {\n              throw createInvalidStateError();\n            }\n          },\n          // Bug #156: Chrome & Opera do not yet fire an ErrorEvent.\n          onprocessorerror: {\n            get: () => onprocessorerror,\n            set: value => {\n              if (typeof onprocessorerror === 'function') {\n                nativeAudioWorkletNode.removeEventListener('processorerror', onprocessorerror);\n              }\n\n              onprocessorerror = typeof value === 'function' ? value : null;\n\n              if (typeof onprocessorerror === 'function') {\n                nativeAudioWorkletNode.addEventListener('processorerror', onprocessorerror);\n              }\n            }\n          }\n        });\n\n        nativeAudioWorkletNode.addEventListener = (addEventListener => {\n          return (...args) => {\n            if (args[0] === 'processorerror') {\n              const unpatchedEventListener = typeof args[1] === 'function' ? args[1] : typeof args[1] === 'object' && args[1] !== null && typeof args[1].handleEvent === 'function' ? args[1].handleEvent : null;\n\n              if (unpatchedEventListener !== null) {\n                const patchedEventListener = patchedEventListeners.get(args[1]);\n\n                if (patchedEventListener !== undefined) {\n                  args[1] = patchedEventListener;\n                } else {\n                  args[1] = event => {\n                    unpatchedEventListener(new ErrorEvent(args[0], { ...event,\n                      error: new Error()\n                    }));\n                  };\n\n                  patchedEventListeners.set(unpatchedEventListener, args[1]);\n                }\n              }\n            }\n\n            return addEventListener.call(nativeAudioWorkletNode, args[0], args[1], args[2]);\n          };\n        })(nativeAudioWorkletNode.addEventListener);\n\n        nativeAudioWorkletNode.removeEventListener = (removeEventListener => {\n          return (...args) => {\n            if (args[0] === 'processorerror') {\n              const patchedEventListener = patchedEventListeners.get(args[1]);\n\n              if (patchedEventListener !== undefined) {\n                patchedEventListeners.delete(args[1]);\n                args[1] = patchedEventListener;\n              }\n            }\n\n            return removeEventListener.call(nativeAudioWorkletNode, args[0], args[1], args[2]);\n          };\n        })(nativeAudioWorkletNode.removeEventListener);\n\n        return nativeAudioWorkletNode;\n      } catch (err) {\n        // Bug #60: Chrome & Opera throw an InvalidStateError instead of a NotSupportedError.\n        if (err.code === 11) {\n          throw createNotSupportedError();\n        }\n\n        throw err; // tslint:disable-line:rxjs-throw-error\n      }\n    } // Bug #61: Only Chrome & Opera have an implementation of the AudioWorkletNode yet.\n\n\n    if (processorConstructor === undefined) {\n      throw createNotSupportedError();\n    }\n\n    testClonabilityOfAudioWorkletNodeOptions(options);\n    return createNativeAudioWorkletNodeFaker(nativeContext, baseLatency, processorConstructor, options);\n  };\n};","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/node_modules/standardized-audio-context/build/es2018/factories/native-audio-worklet-node-factory.js"],"names":["testClonabilityOfAudioWorkletNodeOptions","createNativeAudioWorkletNodeFactory","createInvalidStateError","createNativeAudioNode","createNativeAudioWorkletNodeFaker","createNotSupportedError","isNativeOfflineAudioContext","nativeContext","baseLatency","nativeAudioWorkletNodeConstructor","name","processorConstructor","options","nativeAudioWorkletNode","ntvCntxt","numberOfInputs","numberOfOutputs","outputChannelCount","parameterData","hasNoOutput","patchedEventListeners","Map","onprocessorerror","Object","defineProperties","channelCount","get","set","channelCountMode","value","removeEventListener","addEventListener","args","unpatchedEventListener","handleEvent","patchedEventListener","undefined","event","ErrorEvent","error","Error","call","delete","err","code"],"mappings":"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","sourcesContent":["import { testClonabilityOfAudioWorkletNodeOptions } from '../helpers/test-clonability-of-audio-worklet-node-options';\nexport const createNativeAudioWorkletNodeFactory = (createInvalidStateError, createNativeAudioNode, createNativeAudioWorkletNodeFaker, createNotSupportedError, isNativeOfflineAudioContext) => {\n    return (nativeContext, baseLatency, nativeAudioWorkletNodeConstructor, name, processorConstructor, options) => {\n        if (nativeAudioWorkletNodeConstructor !== null) {\n            try {\n                // Bug #86: Chrome & Opera do not invoke the process() function if the corresponding AudioWorkletNode has no output.\n                const nativeAudioWorkletNode = createNativeAudioNode(nativeContext, (ntvCntxt) => {\n                    return (isNativeOfflineAudioContext(ntvCntxt) && options.numberOfInputs !== 0 && options.numberOfOutputs === 0) ?\n                        new nativeAudioWorkletNodeConstructor(ntvCntxt, name, {\n                            ...options,\n                            numberOfOutputs: 1,\n                            outputChannelCount: [1],\n                            parameterData: { ...options.parameterData, hasNoOutput: 1 }\n                        }) :\n                        new nativeAudioWorkletNodeConstructor(ntvCntxt, name, options);\n                });\n                const patchedEventListeners = new Map(); // tslint:disable-line:max-line-length\n                let onprocessorerror = null;\n                Object.defineProperties(nativeAudioWorkletNode, {\n                    /*\n                     * Bug #61: Overwriting the property accessors for channelCount and channelCountMode is necessary as long as some\n                     * browsers have no native implementation to achieve a consistent behavior.\n                     */\n                    channelCount: {\n                        get: () => options.channelCount,\n                        set: () => {\n                            throw createInvalidStateError();\n                        }\n                    },\n                    channelCountMode: {\n                        get: () => 'explicit',\n                        set: () => {\n                            throw createInvalidStateError();\n                        }\n                    },\n                    // Bug #156: Chrome & Opera do not yet fire an ErrorEvent.\n                    onprocessorerror: {\n                        get: () => onprocessorerror,\n                        set: (value) => {\n                            if (typeof onprocessorerror === 'function') {\n                                nativeAudioWorkletNode.removeEventListener('processorerror', onprocessorerror);\n                            }\n                            onprocessorerror = (typeof value === 'function') ? value : null;\n                            if (typeof onprocessorerror === 'function') {\n                                nativeAudioWorkletNode.addEventListener('processorerror', onprocessorerror);\n                            }\n                        }\n                    }\n                });\n                nativeAudioWorkletNode.addEventListener = ((addEventListener) => {\n                    return (...args) => {\n                        if (args[0] === 'processorerror') {\n                            const unpatchedEventListener = (typeof args[1] === 'function')\n                                ? args[1]\n                                : (typeof args[1] === 'object' && args[1] !== null && typeof args[1].handleEvent === 'function')\n                                    ? args[1].handleEvent\n                                    : null;\n                            if (unpatchedEventListener !== null) {\n                                const patchedEventListener = patchedEventListeners.get(args[1]);\n                                if (patchedEventListener !== undefined) {\n                                    args[1] = patchedEventListener;\n                                }\n                                else {\n                                    args[1] = (event) => {\n                                        unpatchedEventListener(new ErrorEvent(args[0], { ...event, error: new Error( /* @todo */) }));\n                                    };\n                                    patchedEventListeners.set(unpatchedEventListener, args[1]);\n                                }\n                            }\n                        }\n                        return addEventListener.call(nativeAudioWorkletNode, args[0], args[1], args[2]);\n                    };\n                })(nativeAudioWorkletNode.addEventListener);\n                nativeAudioWorkletNode.removeEventListener = ((removeEventListener) => {\n                    return (...args) => {\n                        if (args[0] === 'processorerror') {\n                            const patchedEventListener = patchedEventListeners.get(args[1]);\n                            if (patchedEventListener !== undefined) {\n                                patchedEventListeners.delete(args[1]);\n                                args[1] = patchedEventListener;\n                            }\n                        }\n                        return removeEventListener.call(nativeAudioWorkletNode, args[0], args[1], args[2]);\n                    };\n                })(nativeAudioWorkletNode.removeEventListener);\n                return nativeAudioWorkletNode;\n            }\n            catch (err) {\n                // Bug #60: Chrome & Opera throw an InvalidStateError instead of a NotSupportedError.\n                if (err.code === 11) {\n                    throw createNotSupportedError();\n                }\n                throw err; // tslint:disable-line:rxjs-throw-error\n            }\n        }\n        // Bug #61: Only Chrome & Opera have an implementation of the AudioWorkletNode yet.\n        if (processorConstructor === undefined) {\n            throw createNotSupportedError();\n        }\n        testClonabilityOfAudioWorkletNodeOptions(options);\n        return createNativeAudioWorkletNodeFaker(nativeContext, baseLatency, processorConstructor, options);\n    };\n};\n//# sourceMappingURL=/build/es2018/factories/native-audio-worklet-node-factory.js.map"]},"metadata":{},"sourceType":"module"}