{"ast":null,"code":"import _classCallCheck from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { isValidLatencyHint } from '../helpers/is-valid-latency-hint';\nexport var createAudioContextConstructor = function createAudioContextConstructor(baseAudioContextConstructor, createInvalidStateError, createNotSupportedError, createUnknownError, mediaElementAudioSourceNodeConstructor, mediaStreamAudioSourceNodeConstructor, mediaStreamTrackAudioSourceNodeConstructor, nativeAudioContextConstructor) {\n  return /*#__PURE__*/function (_baseAudioContextCons) {\n    _inherits(AudioContext, _baseAudioContextCons);\n\n    var _super = _createSuper(AudioContext);\n\n    function AudioContext() {\n      var _this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      _classCallCheck(this, AudioContext);\n\n      if (nativeAudioContextConstructor === null) {\n        throw new Error('Missing the native AudioContext constructor.');\n      }\n\n      var nativeAudioContext = new nativeAudioContextConstructor(options); // Bug #131 Safari returns null when there are four other AudioContexts running already.\n\n      if (nativeAudioContext === null) {\n        throw createUnknownError();\n      } // Bug #51 Only Chrome and Opera throw an error if the given latencyHint is invalid.\n\n\n      if (!isValidLatencyHint(options.latencyHint)) {\n        throw new TypeError(\"The provided value '\".concat(options.latencyHint, \"' is not a valid enum value of type AudioContextLatencyCategory.\"));\n      } // Bug #150 Only Chrome, Firefox and Opera support setting the sampleRate.\n\n\n      if (options.sampleRate !== undefined && nativeAudioContext.sampleRate !== options.sampleRate) {\n        throw createNotSupportedError();\n      }\n\n      _this = _super.call(this, nativeAudioContext, 2);\n      var latencyHint = options.latencyHint;\n      var sampleRate = nativeAudioContext.sampleRate; // @todo The values for 'balanced', 'interactive' and 'playback' are just copied from Chrome's implementation.\n\n      _this._baseLatency = typeof nativeAudioContext.baseLatency === 'number' ? nativeAudioContext.baseLatency : latencyHint === 'balanced' ? 512 / sampleRate : latencyHint === 'interactive' || latencyHint === undefined ? 256 / sampleRate : latencyHint === 'playback' ? 1024 / sampleRate :\n      /*\n       * @todo The min (256) and max (16384) values are taken from the allowed bufferSize values of a\n       * ScriptProcessorNode.\n       */\n      Math.max(2, Math.min(128, Math.round(latencyHint * sampleRate / 128))) * 128 / sampleRate;\n      _this._nativeAudioContext = nativeAudioContext;\n      _this._state = null;\n      /*\n       * Bug #34: Chrome and Opera pretend to be running right away, but fire an onstatechange event when the state actually changes\n       * to 'running'.\n       */\n\n      if (nativeAudioContext.state === 'running') {\n        _this._state = 'suspended';\n\n        var revokeState = function revokeState() {\n          if (_this._state === 'suspended') {\n            _this._state = null;\n          }\n\n          nativeAudioContext.removeEventListener('statechange', revokeState);\n        };\n\n        nativeAudioContext.addEventListener('statechange', revokeState);\n      }\n\n      return _this;\n    }\n\n    _createClass(AudioContext, [{\n      key: \"close\",\n      value: function close() {\n        // Bug #35: Firefox does not throw an error if the AudioContext was closed before.\n        if (this.state === 'closed') {\n          return this._nativeAudioContext.close().then(function () {\n            throw createInvalidStateError();\n          });\n        } // Bug #34: If the state was set to suspended before it should be revoked now.\n\n\n        if (this._state === 'suspended') {\n          this._state = null;\n        }\n\n        return this._nativeAudioContext.close();\n        /*\n         * Bug #50: Deleting the AudioGraph is currently not possible anymore.\n         * ...then(() => deleteAudioGraph(this, this._nativeAudioContext));\n         */\n      }\n    }, {\n      key: \"createMediaElementSource\",\n      value: function createMediaElementSource(mediaElement) {\n        return new mediaElementAudioSourceNodeConstructor(this, {\n          mediaElement: mediaElement\n        });\n      }\n    }, {\n      key: \"createMediaStreamSource\",\n      value: function createMediaStreamSource(mediaStream) {\n        return new mediaStreamAudioSourceNodeConstructor(this, {\n          mediaStream: mediaStream\n        });\n      }\n    }, {\n      key: \"createMediaStreamTrackSource\",\n      value: function createMediaStreamTrackSource(mediaStreamTrack) {\n        return new mediaStreamTrackAudioSourceNodeConstructor(this, {\n          mediaStreamTrack: mediaStreamTrack\n        });\n      }\n    }, {\n      key: \"resume\",\n      value: function resume() {\n        var _this2 = this;\n\n        if (this._state === 'suspended') {\n          return new Promise(function (resolve, reject) {\n            var resolvePromise = function resolvePromise() {\n              _this2._nativeAudioContext.removeEventListener('statechange', resolvePromise);\n\n              if (_this2._nativeAudioContext.state === 'running') {\n                resolve();\n              } else {\n                _this2.resume().then(resolve, reject);\n              }\n            };\n\n            _this2._nativeAudioContext.addEventListener('statechange', resolvePromise);\n          });\n        }\n\n        return this._nativeAudioContext.resume().catch(function (err) {\n          // Bug #55: Chrome, Edge and Opera do throw an InvalidAccessError instead of an InvalidStateError.\n          // Bug #56: Safari invokes the catch handler but without an error.\n          if (err === undefined || err.code === 15) {\n            throw createInvalidStateError();\n          }\n\n          throw err; // tslint:disable-line:rxjs-throw-error\n        });\n      }\n    }, {\n      key: \"suspend\",\n      value: function suspend() {\n        return this._nativeAudioContext.suspend().catch(function (err) {\n          // Bug #56: Safari invokes the catch handler but without an error.\n          if (err === undefined) {\n            throw createInvalidStateError();\n          }\n\n          throw err; // tslint:disable-line:rxjs-throw-error\n        });\n      }\n    }, {\n      key: \"baseLatency\",\n      get: function get() {\n        return this._baseLatency;\n      }\n    }, {\n      key: \"state\",\n      get: function get() {\n        return this._state !== null ? this._state : this._nativeAudioContext.state;\n      }\n    }]);\n\n    return AudioContext;\n  }(baseAudioContextConstructor);\n};","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/node_modules/standardized-audio-context/build/es2018/factories/audio-context-constructor.js"],"names":["isValidLatencyHint","createAudioContextConstructor","baseAudioContextConstructor","createInvalidStateError","createNotSupportedError","createUnknownError","mediaElementAudioSourceNodeConstructor","mediaStreamAudioSourceNodeConstructor","mediaStreamTrackAudioSourceNodeConstructor","nativeAudioContextConstructor","options","Error","nativeAudioContext","latencyHint","TypeError","sampleRate","undefined","_baseLatency","baseLatency","Math","max","min","round","_nativeAudioContext","_state","state","revokeState","removeEventListener","addEventListener","close","then","mediaElement","mediaStream","mediaStreamTrack","Promise","resolve","reject","resolvePromise","resume","catch","err","code","suspend"],"mappings":"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","sourcesContent":["import { isValidLatencyHint } from '../helpers/is-valid-latency-hint';\nexport const createAudioContextConstructor = (baseAudioContextConstructor, createInvalidStateError, createNotSupportedError, createUnknownError, mediaElementAudioSourceNodeConstructor, mediaStreamAudioSourceNodeConstructor, mediaStreamTrackAudioSourceNodeConstructor, nativeAudioContextConstructor) => {\n    return class AudioContext extends baseAudioContextConstructor {\n        constructor(options = {}) {\n            if (nativeAudioContextConstructor === null) {\n                throw new Error('Missing the native AudioContext constructor.');\n            }\n            const nativeAudioContext = new nativeAudioContextConstructor(options);\n            // Bug #131 Safari returns null when there are four other AudioContexts running already.\n            if (nativeAudioContext === null) {\n                throw createUnknownError();\n            }\n            // Bug #51 Only Chrome and Opera throw an error if the given latencyHint is invalid.\n            if (!isValidLatencyHint(options.latencyHint)) {\n                throw new TypeError(`The provided value '${options.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);\n            }\n            // Bug #150 Only Chrome, Firefox and Opera support setting the sampleRate.\n            if (options.sampleRate !== undefined && nativeAudioContext.sampleRate !== options.sampleRate) {\n                throw createNotSupportedError();\n            }\n            super(nativeAudioContext, 2);\n            const { latencyHint } = options;\n            const { sampleRate } = nativeAudioContext;\n            // @todo The values for 'balanced', 'interactive' and 'playback' are just copied from Chrome's implementation.\n            this._baseLatency = (typeof nativeAudioContext.baseLatency === 'number')\n                ? nativeAudioContext.baseLatency\n                : (latencyHint === 'balanced')\n                    ? (512 / sampleRate)\n                    : (latencyHint === 'interactive' || latencyHint === undefined)\n                        ? (256 / sampleRate)\n                        : (latencyHint === 'playback')\n                            ? (1024 / sampleRate)\n                            /*\n                             * @todo The min (256) and max (16384) values are taken from the allowed bufferSize values of a\n                             * ScriptProcessorNode.\n                             */\n                            : ((Math.max(2, Math.min(128, Math.round((latencyHint * sampleRate) / 128))) * 128) / sampleRate);\n            this._nativeAudioContext = nativeAudioContext;\n            this._state = null;\n            /*\n             * Bug #34: Chrome and Opera pretend to be running right away, but fire an onstatechange event when the state actually changes\n             * to 'running'.\n             */\n            if (nativeAudioContext.state === 'running') {\n                this._state = 'suspended';\n                const revokeState = () => {\n                    if (this._state === 'suspended') {\n                        this._state = null;\n                    }\n                    nativeAudioContext.removeEventListener('statechange', revokeState);\n                };\n                nativeAudioContext.addEventListener('statechange', revokeState);\n            }\n        }\n        get baseLatency() {\n            return this._baseLatency;\n        }\n        get state() {\n            return (this._state !== null) ? this._state : this._nativeAudioContext.state;\n        }\n        close() {\n            // Bug #35: Firefox does not throw an error if the AudioContext was closed before.\n            if (this.state === 'closed') {\n                return this._nativeAudioContext\n                    .close()\n                    .then(() => {\n                    throw createInvalidStateError();\n                });\n            }\n            // Bug #34: If the state was set to suspended before it should be revoked now.\n            if (this._state === 'suspended') {\n                this._state = null;\n            }\n            return this._nativeAudioContext.close();\n            /*\n             * Bug #50: Deleting the AudioGraph is currently not possible anymore.\n             * ...then(() => deleteAudioGraph(this, this._nativeAudioContext));\n             */\n        }\n        createMediaElementSource(mediaElement) {\n            return new mediaElementAudioSourceNodeConstructor(this, { mediaElement });\n        }\n        createMediaStreamSource(mediaStream) {\n            return new mediaStreamAudioSourceNodeConstructor(this, { mediaStream });\n        }\n        createMediaStreamTrackSource(mediaStreamTrack) {\n            return new mediaStreamTrackAudioSourceNodeConstructor(this, { mediaStreamTrack });\n        }\n        resume() {\n            if (this._state === 'suspended') {\n                return new Promise((resolve, reject) => {\n                    const resolvePromise = () => {\n                        this._nativeAudioContext.removeEventListener('statechange', resolvePromise);\n                        if (this._nativeAudioContext.state === 'running') {\n                            resolve();\n                        }\n                        else {\n                            this\n                                .resume()\n                                .then(resolve, reject);\n                        }\n                    };\n                    this._nativeAudioContext.addEventListener('statechange', resolvePromise);\n                });\n            }\n            return this._nativeAudioContext\n                .resume()\n                .catch((err) => {\n                // Bug #55: Chrome, Edge and Opera do throw an InvalidAccessError instead of an InvalidStateError.\n                // Bug #56: Safari invokes the catch handler but without an error.\n                if (err === undefined || err.code === 15) {\n                    throw createInvalidStateError();\n                }\n                throw err; // tslint:disable-line:rxjs-throw-error\n            });\n        }\n        suspend() {\n            return this._nativeAudioContext\n                .suspend()\n                .catch((err) => {\n                // Bug #56: Safari invokes the catch handler but without an error.\n                if (err === undefined) {\n                    throw createInvalidStateError();\n                }\n                throw err; // tslint:disable-line:rxjs-throw-error\n            });\n        }\n    };\n};\n//# sourceMappingURL=/build/es2018/factories/audio-context-constructor.js.map"]},"metadata":{},"sourceType":"module"}