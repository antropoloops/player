{"ast":null,"code":"/**\n * SOURCE: https://github.com/swevans/unmute\n * SEE: https://stackoverflow.com/questions/21122418/ios-webaudio-only-works-on-headphones\n */ /**\n * @file unmute.ts\n * @author Spencer Evans evans.spencer@gmail.com\n * unmute is a disgusting hack that helps..\n * \t1) automatically resume web audio contexts on user interaction\n * \t2) ios only: web audio play on the media channel rather than the ringer channel\n * \t3) ios only: disable the media playback widget and airplay.\n * \t4) automatically pause and resume web audio when the page is hidden.\n * Auto resuming works by checking context state and calling resume during any resumable event.\n * Media channel playback and media widget disabling work by playing an airplay-disabled silent html audio track in the background.\n * Automatic pausing when the page is hidden is supported by both the page visibility api AND blur events because ios has a poor implementation of the page visibility api.\n * This is all really gross and apple should really fix their janky browser.\n * This code isn't optimized in any fashion, it is just whipped up to help someone out on stack overflow, its just meant as an example.\n */ /**\n * Enables unmute.\n * @param context A reference to the web audio context to \"unmute\".\n */export default function unmute(context){var pageVisibilityAPI;if(document.hidden!==undefined)pageVisibilityAPI={hidden:\"hidden\",visibilitychange:\"visibilitychange\"};else if(document.webkitHidden!==undefined)pageVisibilityAPI={hidden:\"webkitHidden\",visibilitychange:\"webkitvisibilitychange\"};else if(document.mozHidden!==undefined)pageVisibilityAPI={hidden:\"mozHidden\",visibilitychange:\"mozvisibilitychange\"};else if(document.msHidden!==undefined)pageVisibilityAPI={hidden:\"msHidden\",visibilitychange:\"msvisibilitychange\"};// Determine if ios\nvar ua=navigator.userAgent.toLowerCase();var isIOS=ua.indexOf(\"iphone\")>=0&&ua.indexOf(\"like iphone\")<0||ua.indexOf(\"ipad\")>=0&&ua.indexOf(\"like ipad\")<0||ua.indexOf(\"ipod\")>=0&&ua.indexOf(\"like ipod\")<0;// Track page state\nvar isPageActive=true;var isPageVisible=true;var iosIsPageFocused=true;// iOS has a buggy page visibility API, luckily it dispatches blur and focus events on the window when vis change events should fire.\n// Track desired audio state\nvar suspendAudio=false;var audioUnlockingEvents=[\"click\",\"contextmenu\",\"auxclick\",\"dblclick\",\"mousedown\",\"mouseup\",\"touchend\",\"keydown\",\"keyup\"];// Track web audio state\nvar contextUnlockingEnabled=false;// Track html audio state\nvar tag;var tagUnlockingEnabled=false;var tagPendingChange=false;function contextStateCheck(tryResuming){if(context.state===\"running\"){// No need to watch for unlocking events while running\ntoggleContextUnlocking(false);// Check if our state matches\nif(suspendAudio){// We want to be suspended, we can suspend at any time\ncontext.suspend().then(context_promiseHandler,context_promiseHandler);}}else if(context.state!==\"closed\"){// Interrupted or suspended, check if our state matches\nif(!suspendAudio){// We want to be running\ntoggleContextUnlocking(true);if(tryResuming)context.resume().then(context_promiseHandler,context_promiseHandler);}else{// We don't want to be running, so no need to watch for unlocking events\ntoggleContextUnlocking(false);}}}function toggleContextUnlocking(enable){if(contextUnlockingEnabled===enable)return;contextUnlockingEnabled=enable;for(var _i=0,audioUnlockingEvents_1=audioUnlockingEvents;_i<audioUnlockingEvents_1.length;_i++){var evt=audioUnlockingEvents_1[_i];if(enable)window.addEventListener(evt,context_unlockingEvent,{capture:true,passive:true});else window.removeEventListener(evt,context_unlockingEvent,{capture:true,passive:true});}}function context_statechange(){contextStateCheck(true);}function context_promiseHandler(){contextStateCheck(false);}function context_unlockingEvent(){contextStateCheck(true);}function tagStateCheck(tryChange){// We have a pending state change, let that resolve first\nif(tagPendingChange)return;if(!tag.paused){// No need to watch for unlocking events while running\ntoggleTagUnlocking(false);// Check if our state matches\nif(suspendAudio){// We want to be suspended, we can suspend at any time\ntag.pause();// instant action, so no need to set as pending\n}}else{// Tag isn't playing, check if our state matches\nif(!suspendAudio){// We want to be running\nif(tryChange){// Try forcing a change, so stop watching for unlocking events while attempt is in progress\ntoggleTagUnlocking(false);// Attempt to play\ntagPendingChange=true;var p=void 0;try{p=tag.play();if(p)p.then(tag_promiseHandler,tag_promiseHandler);else{tag.addEventListener(\"playing\",tag_promiseHandler);tag.addEventListener(\"abort\",tag_promiseHandler);tag.addEventListener(\"error\",tag_promiseHandler);}}catch(err){tag_promiseHandler();}}else{// We're not going to try resuming this time, but make sure unlocking events are enabled\ntoggleTagUnlocking(true);}}else{// We don't want to be running, so no need to watch for unlocking events\ntoggleTagUnlocking(false);}}}function toggleTagUnlocking(enable){if(tagUnlockingEnabled===enable)return;tagUnlockingEnabled=enable;for(var _i=0,audioUnlockingEvents_2=audioUnlockingEvents;_i<audioUnlockingEvents_2.length;_i++){var evt=audioUnlockingEvents_2[_i];if(enable)window.addEventListener(evt,tag_unlockingEvent,{capture:true,passive:true});else window.removeEventListener(evt,tag_unlockingEvent,{capture:true,passive:true});}}function tag_promiseHandler(){tag.removeEventListener(\"playing\",tag_promiseHandler);tag.removeEventListener(\"abort\",tag_promiseHandler);tag.removeEventListener(\"error\",tag_promiseHandler);// Tag started playing, so we're not suspended\ntagPendingChange=false;tagStateCheck(false);}function tag_unlockingEvent(){tagStateCheck(true);}/**\n   * Called when the page becomes active.\n   */function pageActivated(){suspendAudio=false;if(tag)tagStateCheck(true);// tag first to ensure media channel start first\ncontextStateCheck(true);}/**\n   * Called when the page becomes inactive.\n   */function pageDeactivated(){suspendAudio=true;contextStateCheck(true);// context first to be sure it stops before the tag\nif(tag)tagStateCheck(true);}/**\n   * Updates page active state.\n   */function pageStateCheck(){if(isPageVisible&&iosIsPageFocused){if(!isPageActive){isPageActive=true;pageActivated();}}else{if(isPageActive){isPageActive=false;pageDeactivated();}}}/**\n   * Handle visibility api events.\n   */function doc_visChange(){if(pageVisibilityAPI){if(document[pageVisibilityAPI.hidden]===isPageActive){isPageVisible=!document[pageVisibilityAPI.hidden];pageStateCheck();}}}/**\n   * Handles blur events (ios only).\n   */function win_focusChange(evt){if(evt&&evt.target!==window)return;if(document.hasFocus()){if(iosIsPageFocused)return;iosIsPageFocused=true;pageStateCheck();}else{if(!iosIsPageFocused)return;iosIsPageFocused=false;pageStateCheck();}}/**\n   * A utility function for decompressing the base64 silence string.\n   * @param c The number of times the string is repeated in the string segment.\n   * @param a The string to repeat.\n   */function poorManHuffman(c,a){var e;for(e=a;c>1;c--){e+=a;}return e;}// Watch for tag state changes and check initial state\nif(isIOS){// Is ios, we need to play an html track in the background and disable the widget\n// NOTE: media widget / airplay MUST be disabled with this super gross hack to create the audio tag, setting the attribute in js doesn't work\nvar tmp=document.createElement(\"div\");tmp.innerHTML=\"<audio x-webkit-airplay='deny'></audio>\";tag=tmp.children.item(0);tag.controls=false;tag.disableRemotePlayback=true;// Airplay like controls on other devices, prevents casting of the tag\ntag.preload=\"auto\";// Set the src to a short bit of url encoded as a silent mp3\n// NOTE The silence MP3 must be high quality, when web audio sounds are played in parallel the web audio sound is mixed to match the bitrate of the html sound\n// 0.01 seconds of silence VBR220-260 Joint Stereo 859B\n//tag.src = \"data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==\";\n// The str below is a \"compressed\" version using poor mans huffman encoding, saves about 0.5kb\ntag.src=\"data:audio/mpeg;base64,//uQx\"+poorManHuffman(23,\"A\")+\"WGluZwAAAA8AAAACAAACcQCA\"+poorManHuffman(16,\"gICA\")+poorManHuffman(66,\"/\")+\"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI\"+poorManHuffman(320,\"A\")+\"//sQxAADgnABGiAAQBCqgCRMAAgEAH\"+poorManHuffman(15,\"/\")+\"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq\"+poorManHuffman(18,\"/\")+\"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw\"+poorManHuffman(97,\"V\")+\"Q==\";tag.loop=true;tag.load();// Try to play right off the bat\ntagStateCheck(true);}// Watch for context state changes and check initial state\ncontext.onstatechange=context_statechange;// NOTE: the onstatechange callback property is more widely supported than the statechange event\tcontext.addEventListener(\"statechange\", context_statechange);\ncontextStateCheck(false);// Watch for page state changes and check initial page state\nif(pageVisibilityAPI)document.addEventListener(pageVisibilityAPI.visibilitychange,doc_visChange,true);if(isIOS){// Watch for blur / focus events on ios because it doesn't dispatch vis change events properly\nwindow.addEventListener(\"focus\",win_focusChange,true);window.addEventListener(\"blur\",win_focusChange,true);}doc_visChange();win_focusChange();}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/active-audio-context/unmute.js"],"names":["unmute","context","pageVisibilityAPI","document","hidden","undefined","visibilitychange","webkitHidden","mozHidden","msHidden","ua","navigator","userAgent","toLowerCase","isIOS","indexOf","isPageActive","isPageVisible","iosIsPageFocused","suspendAudio","audioUnlockingEvents","contextUnlockingEnabled","tag","tagUnlockingEnabled","tagPendingChange","contextStateCheck","tryResuming","state","toggleContextUnlocking","suspend","then","context_promiseHandler","resume","enable","_i","audioUnlockingEvents_1","length","evt","window","addEventListener","context_unlockingEvent","capture","passive","removeEventListener","context_statechange","tagStateCheck","tryChange","paused","toggleTagUnlocking","pause","p","play","tag_promiseHandler","err","audioUnlockingEvents_2","tag_unlockingEvent","pageActivated","pageDeactivated","pageStateCheck","doc_visChange","win_focusChange","target","hasFocus","poorManHuffman","c","a","e","tmp","createElement","innerHTML","children","item","controls","disableRemotePlayback","preload","src","loop","load","onstatechange"],"mappings":"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","sourcesContent":["/**\n * SOURCE: https://github.com/swevans/unmute\n * SEE: https://stackoverflow.com/questions/21122418/ios-webaudio-only-works-on-headphones\n */\n\n/**\n * @file unmute.ts\n * @author Spencer Evans evans.spencer@gmail.com\n * unmute is a disgusting hack that helps..\n * \t1) automatically resume web audio contexts on user interaction\n * \t2) ios only: web audio play on the media channel rather than the ringer channel\n * \t3) ios only: disable the media playback widget and airplay.\n * \t4) automatically pause and resume web audio when the page is hidden.\n * Auto resuming works by checking context state and calling resume during any resumable event.\n * Media channel playback and media widget disabling work by playing an airplay-disabled silent html audio track in the background.\n * Automatic pausing when the page is hidden is supported by both the page visibility api AND blur events because ios has a poor implementation of the page visibility api.\n * This is all really gross and apple should really fix their janky browser.\n * This code isn't optimized in any fashion, it is just whipped up to help someone out on stack overflow, its just meant as an example.\n */\n/**\n * Enables unmute.\n * @param context A reference to the web audio context to \"unmute\".\n */\nexport default function unmute(context) {\n  var pageVisibilityAPI;\n  if (document.hidden !== undefined)\n    pageVisibilityAPI = {\n      hidden: \"hidden\",\n      visibilitychange: \"visibilitychange\",\n    };\n  else if (document.webkitHidden !== undefined)\n    pageVisibilityAPI = {\n      hidden: \"webkitHidden\",\n      visibilitychange: \"webkitvisibilitychange\",\n    };\n  else if (document.mozHidden !== undefined)\n    pageVisibilityAPI = {\n      hidden: \"mozHidden\",\n      visibilitychange: \"mozvisibilitychange\",\n    };\n  else if (document.msHidden !== undefined)\n    pageVisibilityAPI = {\n      hidden: \"msHidden\",\n      visibilitychange: \"msvisibilitychange\",\n    };\n  // Determine if ios\n  var ua = navigator.userAgent.toLowerCase();\n  var isIOS =\n    (ua.indexOf(\"iphone\") >= 0 && ua.indexOf(\"like iphone\") < 0) ||\n    (ua.indexOf(\"ipad\") >= 0 && ua.indexOf(\"like ipad\") < 0) ||\n    (ua.indexOf(\"ipod\") >= 0 && ua.indexOf(\"like ipod\") < 0);\n  // Track page state\n  var isPageActive = true;\n  var isPageVisible = true;\n  var iosIsPageFocused = true; // iOS has a buggy page visibility API, luckily it dispatches blur and focus events on the window when vis change events should fire.\n  // Track desired audio state\n  var suspendAudio = false;\n  var audioUnlockingEvents = [\n    \"click\",\n    \"contextmenu\",\n    \"auxclick\",\n    \"dblclick\",\n    \"mousedown\",\n    \"mouseup\",\n    \"touchend\",\n    \"keydown\",\n    \"keyup\",\n  ];\n  // Track web audio state\n  var contextUnlockingEnabled = false;\n  // Track html audio state\n  var tag;\n  var tagUnlockingEnabled = false;\n  var tagPendingChange = false;\n  function contextStateCheck(tryResuming) {\n    if (context.state === \"running\") {\n      // No need to watch for unlocking events while running\n      toggleContextUnlocking(false);\n      // Check if our state matches\n      if (suspendAudio) {\n        // We want to be suspended, we can suspend at any time\n        context.suspend().then(context_promiseHandler, context_promiseHandler);\n      }\n    } else if (context.state !== \"closed\") {\n      // Interrupted or suspended, check if our state matches\n      if (!suspendAudio) {\n        // We want to be running\n        toggleContextUnlocking(true);\n        if (tryResuming)\n          context.resume().then(context_promiseHandler, context_promiseHandler);\n      } else {\n        // We don't want to be running, so no need to watch for unlocking events\n        toggleContextUnlocking(false);\n      }\n    }\n  }\n  function toggleContextUnlocking(enable) {\n    if (contextUnlockingEnabled === enable) return;\n    contextUnlockingEnabled = enable;\n    for (\n      var _i = 0, audioUnlockingEvents_1 = audioUnlockingEvents;\n      _i < audioUnlockingEvents_1.length;\n      _i++\n    ) {\n      var evt = audioUnlockingEvents_1[_i];\n      if (enable)\n        window.addEventListener(evt, context_unlockingEvent, {\n          capture: true,\n          passive: true,\n        });\n      else\n        window.removeEventListener(evt, context_unlockingEvent, {\n          capture: true,\n          passive: true,\n        });\n    }\n  }\n  function context_statechange() {\n    contextStateCheck(true);\n  }\n  function context_promiseHandler() {\n    contextStateCheck(false);\n  }\n  function context_unlockingEvent() {\n    contextStateCheck(true);\n  }\n  function tagStateCheck(tryChange) {\n    // We have a pending state change, let that resolve first\n    if (tagPendingChange) return;\n    if (!tag.paused) {\n      // No need to watch for unlocking events while running\n      toggleTagUnlocking(false);\n      // Check if our state matches\n      if (suspendAudio) {\n        // We want to be suspended, we can suspend at any time\n        tag.pause(); // instant action, so no need to set as pending\n      }\n    } else {\n      // Tag isn't playing, check if our state matches\n      if (!suspendAudio) {\n        // We want to be running\n        if (tryChange) {\n          // Try forcing a change, so stop watching for unlocking events while attempt is in progress\n          toggleTagUnlocking(false);\n          // Attempt to play\n          tagPendingChange = true;\n          var p = void 0;\n          try {\n            p = tag.play();\n            if (p) p.then(tag_promiseHandler, tag_promiseHandler);\n            else {\n              tag.addEventListener(\"playing\", tag_promiseHandler);\n              tag.addEventListener(\"abort\", tag_promiseHandler);\n              tag.addEventListener(\"error\", tag_promiseHandler);\n            }\n          } catch (err) {\n            tag_promiseHandler();\n          }\n        } else {\n          // We're not going to try resuming this time, but make sure unlocking events are enabled\n          toggleTagUnlocking(true);\n        }\n      } else {\n        // We don't want to be running, so no need to watch for unlocking events\n        toggleTagUnlocking(false);\n      }\n    }\n  }\n  function toggleTagUnlocking(enable) {\n    if (tagUnlockingEnabled === enable) return;\n    tagUnlockingEnabled = enable;\n    for (\n      var _i = 0, audioUnlockingEvents_2 = audioUnlockingEvents;\n      _i < audioUnlockingEvents_2.length;\n      _i++\n    ) {\n      var evt = audioUnlockingEvents_2[_i];\n      if (enable)\n        window.addEventListener(evt, tag_unlockingEvent, {\n          capture: true,\n          passive: true,\n        });\n      else\n        window.removeEventListener(evt, tag_unlockingEvent, {\n          capture: true,\n          passive: true,\n        });\n    }\n  }\n  function tag_promiseHandler() {\n    tag.removeEventListener(\"playing\", tag_promiseHandler);\n    tag.removeEventListener(\"abort\", tag_promiseHandler);\n    tag.removeEventListener(\"error\", tag_promiseHandler);\n    // Tag started playing, so we're not suspended\n    tagPendingChange = false;\n    tagStateCheck(false);\n  }\n  function tag_unlockingEvent() {\n    tagStateCheck(true);\n  }\n  /**\n   * Called when the page becomes active.\n   */\n  function pageActivated() {\n    suspendAudio = false;\n    if (tag) tagStateCheck(true); // tag first to ensure media channel start first\n    contextStateCheck(true);\n  }\n  /**\n   * Called when the page becomes inactive.\n   */\n  function pageDeactivated() {\n    suspendAudio = true;\n    contextStateCheck(true); // context first to be sure it stops before the tag\n    if (tag) tagStateCheck(true);\n  }\n  /**\n   * Updates page active state.\n   */\n  function pageStateCheck() {\n    if (isPageVisible && iosIsPageFocused) {\n      if (!isPageActive) {\n        isPageActive = true;\n        pageActivated();\n      }\n    } else {\n      if (isPageActive) {\n        isPageActive = false;\n        pageDeactivated();\n      }\n    }\n  }\n  /**\n   * Handle visibility api events.\n   */\n  function doc_visChange() {\n    if (pageVisibilityAPI) {\n      if (document[pageVisibilityAPI.hidden] === isPageActive) {\n        isPageVisible = !document[pageVisibilityAPI.hidden];\n        pageStateCheck();\n      }\n    }\n  }\n  /**\n   * Handles blur events (ios only).\n   */\n  function win_focusChange(evt) {\n    if (evt && evt.target !== window) return;\n    if (document.hasFocus()) {\n      if (iosIsPageFocused) return;\n      iosIsPageFocused = true;\n      pageStateCheck();\n    } else {\n      if (!iosIsPageFocused) return;\n      iosIsPageFocused = false;\n      pageStateCheck();\n    }\n  }\n  /**\n   * A utility function for decompressing the base64 silence string.\n   * @param c The number of times the string is repeated in the string segment.\n   * @param a The string to repeat.\n   */\n  function poorManHuffman(c, a) {\n    var e;\n    for (e = a; c > 1; c--) e += a;\n    return e;\n  }\n  // Watch for tag state changes and check initial state\n  if (isIOS) {\n    // Is ios, we need to play an html track in the background and disable the widget\n    // NOTE: media widget / airplay MUST be disabled with this super gross hack to create the audio tag, setting the attribute in js doesn't work\n    var tmp = document.createElement(\"div\");\n    tmp.innerHTML = \"<audio x-webkit-airplay='deny'></audio>\";\n    tag = tmp.children.item(0);\n    tag.controls = false;\n    tag.disableRemotePlayback = true; // Airplay like controls on other devices, prevents casting of the tag\n    tag.preload = \"auto\";\n    // Set the src to a short bit of url encoded as a silent mp3\n    // NOTE The silence MP3 must be high quality, when web audio sounds are played in parallel the web audio sound is mixed to match the bitrate of the html sound\n    // 0.01 seconds of silence VBR220-260 Joint Stereo 859B\n    //tag.src = \"data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==\";\n    // The str below is a \"compressed\" version using poor mans huffman encoding, saves about 0.5kb\n    tag.src =\n      \"data:audio/mpeg;base64,//uQx\" +\n      poorManHuffman(23, \"A\") +\n      \"WGluZwAAAA8AAAACAAACcQCA\" +\n      poorManHuffman(16, \"gICA\") +\n      poorManHuffman(66, \"/\") +\n      \"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI\" +\n      poorManHuffman(320, \"A\") +\n      \"//sQxAADgnABGiAAQBCqgCRMAAgEAH\" +\n      poorManHuffman(15, \"/\") +\n      \"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq\" +\n      poorManHuffman(18, \"/\") +\n      \"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw\" +\n      poorManHuffman(97, \"V\") +\n      \"Q==\";\n    tag.loop = true;\n    tag.load();\n    // Try to play right off the bat\n    tagStateCheck(true);\n  }\n  // Watch for context state changes and check initial state\n  context.onstatechange = context_statechange; // NOTE: the onstatechange callback property is more widely supported than the statechange event\tcontext.addEventListener(\"statechange\", context_statechange);\n  contextStateCheck(false);\n  // Watch for page state changes and check initial page state\n  if (pageVisibilityAPI)\n    document.addEventListener(\n      pageVisibilityAPI.visibilitychange,\n      doc_visChange,\n      true\n    );\n  if (isIOS) {\n    // Watch for blur / focus events on ios because it doesn't dispatch vis change events properly\n    window.addEventListener(\"focus\", win_focusChange, true);\n    window.addEventListener(\"blur\", win_focusChange, true);\n  }\n  doc_visChange();\n  win_focusChange();\n}\n"]},"metadata":{},"sourceType":"module"}