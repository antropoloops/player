{"ast":null,"code":"import _slicedToArray from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useEffect, useState } from \"react\";\nimport { getActiveAudioContext } from \"../../player\";\nimport { AudioContextEngine } from \"../../player/AudioContextEngine\";\nimport { AudiosetControl, EmptyControlState } from \"../../player/Control\";\nimport { ResourceLoader } from \"../../player/ResourceLoader\";\nimport { Sampler } from \"../../player/Sampler\";\nexport function usePlayer(audioset) {\n  const _useState = useState(null),\n        _useState2 = _slicedToArray(_useState, 2),\n        control = _useState2[0],\n        setControl = _useState2[1];\n\n  const _useState3 = useState(EmptyControlState),\n        _useState4 = _slicedToArray(_useState3, 2),\n        state = _useState4[0],\n        setState = _useState4[1];\n\n  useEffect(() => {\n    let cancelled = false;\n    let sampler;\n    const loader = new ResourceLoader(audioset, status => {});\n    loader.preload();\n    getActiveAudioContext().then(ctx => {\n      if (cancelled) {\n        return;\n      }\n\n      sampler = createSampler(audioset, ctx, loader);\n      const ctl = new AudiosetControl(audioset, {\n        onControlStateChanged: newState => {\n          setState(newState);\n        },\n        onControlCommand: command => {\n          var _sampler;\n\n          (_sampler = sampler) === null || _sampler === void 0 ? void 0 : _sampler.run(command);\n        }\n      });\n      setControl(ctl);\n      setState(ctl.getState());\n    });\n    return () => {\n      var _sampler2;\n\n      cancelled = true;\n      (_sampler2 = sampler) === null || _sampler2 === void 0 ? void 0 : _sampler2.dispose();\n    };\n  }, [audioset]);\n  return {\n    control,\n    state\n  };\n}\n\nfunction createSampler(audioset, ctx, buffers) {\n  const audio = new AudioContextEngine(ctx);\n  const sampler = new Sampler(audioset, buffers, audio);\n  return sampler;\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/ui/Player/usePlayer.tsx"],"names":["useEffect","useState","getActiveAudioContext","AudioContextEngine","AudiosetControl","EmptyControlState","ResourceLoader","Sampler","usePlayer","audioset","control","setControl","state","setState","cancelled","sampler","loader","status","preload","then","ctx","createSampler","ctl","onControlStateChanged","newState","onControlCommand","command","run","getState","dispose","buffers","audio"],"mappings":";AAAA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AAGA,SAASC,qBAAT,QAAsC,cAAtC;AACA,SAASC,kBAAT,QAAmC,iCAAnC;AACA,SACEC,eADF,EAEEC,iBAFF,QAIO,sBAJP;AAKA,SAASC,cAAT,QAA+B,6BAA/B;AACA,SAASC,OAAT,QAAwB,sBAAxB;AAEA,OAAO,SAASC,SAAT,CAAmBC,QAAnB,EAAuC;AAAA,oBACdR,QAAQ,CAAuB,IAAvB,CADM;AAAA;AAAA,QACrCS,OADqC;AAAA,QAC5BC,UAD4B;;AAAA,qBAElBV,QAAQ,CAACI,iBAAD,CAFU;AAAA;AAAA,QAErCO,KAFqC;AAAA,QAE9BC,QAF8B;;AAI5Cb,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIc,SAAS,GAAG,KAAhB;AACA,QAAIC,OAAJ;AACA,UAAMC,MAAM,GAAG,IAAIV,cAAJ,CAAmBG,QAAnB,EAA6BQ,MAAM,IAAI,CAAE,CAAzC,CAAf;AACAD,IAAAA,MAAM,CAACE,OAAP;AAEAhB,IAAAA,qBAAqB,GAAGiB,IAAxB,CAA6BC,GAAG,IAAI;AAClC,UAAIN,SAAJ,EAAe;AACb;AACD;;AAEDC,MAAAA,OAAO,GAAGM,aAAa,CAACZ,QAAD,EAAWW,GAAX,EAAgBJ,MAAhB,CAAvB;AAEA,YAAMM,GAAG,GAAG,IAAIlB,eAAJ,CAAoBK,QAApB,EAA8B;AACxCc,QAAAA,qBAAqB,EAAEC,QAAQ,IAAI;AACjCX,UAAAA,QAAQ,CAACW,QAAD,CAAR;AACD,SAHuC;AAIxCC,QAAAA,gBAAgB,EAAEC,OAAO,IAAI;AAAA;;AAC3B,sBAAAX,OAAO,UAAP,4CAASY,GAAT,CAAaD,OAAb;AACD;AANuC,OAA9B,CAAZ;AAQAf,MAAAA,UAAU,CAACW,GAAD,CAAV;AACAT,MAAAA,QAAQ,CAACS,GAAG,CAACM,QAAJ,EAAD,CAAR;AACD,KAjBD;AAkBA,WAAO,MAAM;AAAA;;AACXd,MAAAA,SAAS,GAAG,IAAZ;AACA,mBAAAC,OAAO,UAAP,8CAASc,OAAT;AACD,KAHD;AAID,GA5BQ,EA4BN,CAACpB,QAAD,CA5BM,CAAT;AA8BA,SAAO;AAAEC,IAAAA,OAAF;AAAWE,IAAAA;AAAX,GAAP;AACD;;AAED,SAASS,aAAT,CACEZ,QADF,EAEEW,GAFF,EAGEU,OAHF,EAIW;AACT,QAAMC,KAAK,GAAG,IAAI5B,kBAAJ,CAAuBiB,GAAvB,CAAd;AACA,QAAML,OAAO,GAAG,IAAIR,OAAJ,CAAYE,QAAZ,EAAsBqB,OAAtB,EAA+BC,KAA/B,CAAhB;AACA,SAAOhB,OAAP;AACD","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { IAudioContext } from \"standardized-audio-context\";\nimport { Audioset } from \"../../audioset\";\nimport { getActiveAudioContext } from \"../../player\";\nimport { AudioContextEngine } from \"../../player/AudioContextEngine\";\nimport {\n  AudiosetControl,\n  EmptyControlState,\n  PlayerControl,\n} from \"../../player/Control\";\nimport { ResourceLoader } from \"../../player/ResourceLoader\";\nimport { Sampler } from \"../../player/Sampler\";\n\nexport function usePlayer(audioset: Audioset) {\n  const [control, setControl] = useState<PlayerControl | null>(null);\n  const [state, setState] = useState(EmptyControlState);\n\n  useEffect(() => {\n    let cancelled = false;\n    let sampler: Sampler | undefined;\n    const loader = new ResourceLoader(audioset, status => {});\n    loader.preload();\n\n    getActiveAudioContext().then(ctx => {\n      if (cancelled) {\n        return;\n      }\n\n      sampler = createSampler(audioset, ctx, loader);\n\n      const ctl = new AudiosetControl(audioset, {\n        onControlStateChanged: newState => {\n          setState(newState);\n        },\n        onControlCommand: command => {\n          sampler?.run(command);\n        },\n      });\n      setControl(ctl);\n      setState(ctl.getState());\n    });\n    return () => {\n      cancelled = true;\n      sampler?.dispose();\n    };\n  }, [audioset]);\n\n  return { control, state };\n}\n\nfunction createSampler(\n  audioset: Audioset,\n  ctx: IAudioContext,\n  buffers: ResourceLoader,\n): Sampler {\n  const audio = new AudioContextEngine(ctx);\n  const sampler = new Sampler(audioset, buffers, audio);\n  return sampler;\n}\n"]},"metadata":{},"sourceType":"module"}