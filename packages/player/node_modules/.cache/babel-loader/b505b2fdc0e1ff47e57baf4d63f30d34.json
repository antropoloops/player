{"ast":null,"code":"import _slicedToArray from \"/Users/dani/Antropoloops/atpls-player/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport * as topojson from \"topojson\";\nimport { getAlbumHeight } from \"./dimensions\";\nimport drawCircle from \"./drawCircle\";\nimport drawAlbum from \"./drawAlbum\";\nimport drawRefLine from \"./drawRefLine\";\nimport drawWave from \"./drawWave\";\nimport { drawMap, calculateMapScale, createMapProjector } from \"./drawMap\";\nimport { drawPanel, createPanelProjector } from \"./drawPanel\";\nimport getAlbumInfo from \"./getAlbumInfo\";\n\nconst remove = (name, group) => {\n  const value = group[name];\n\n  if (value) {\n    value.remove();\n    group[name] = null;\n  }\n};\n/**\n * It stores the state required to render visualizations\n */\n\n\nexport default class Visuals {\n  constructor(set, display) {\n    this.set = set;\n    this.display = display;\n    this.circles = {};\n    this.albums = {};\n    this.refLines = {};\n    this.mode = set.visuals.mode;\n  }\n\n  setGeodata(geodata) {\n    this.countries = topojson.feature(geodata, geodata.objects.countries).features.filter(country => country.id !== \"010\");\n    this.setup();\n  }\n\n  show(name) {\n    // REVIEW: See if there is a better way to get this info (scale, projection)\n    // that is already calculated in drawMap\n    const _this$display$dimensi = this.display.dimensions,\n          width = _this$display$dimensi.width,\n          height = _this$display$dimensi.height;\n    const _this$set$visuals$geo = this.set.visuals.geomap,\n          scaleFactor = _this$set$visuals$geo.scaleFactor,\n          center = _this$set$visuals$geo.center;\n    const albumsHeight = getAlbumHeight(width);\n    const scale = calculateMapScale(width, height - albumsHeight);\n    const info = getAlbumInfo(this.set, name);\n    if (!info) return;\n    const projector = this.mode === \"map\" ? createMapProjector(width, height - albumsHeight, scaleFactor * scale, center) : createPanelProjector(width, height - albumsHeight, this.set.visuals.image.size.width, this.set.visuals.image.size.height);\n\n    const _projector = projector(info.position),\n          _projector2 = _slicedToArray(_projector, 2),\n          cx = _projector2[0],\n          cy = _projector2[1]; // REVIEW: fix width parameter to draw circles with the proper size\n\n\n    const circle = drawCircle(this.circlesContainer, width, cx, cy, info);\n    this.circles[name] = circle;\n    const album = drawAlbum(this.albumsContainer, width, info);\n    this.albums[name] = album;\n    const refLine = drawRefLine(this.refLinesContainer, width, cx, cy, info.trackNumber, info.trackColor);\n    this.refLines[name] = refLine;\n    drawWave(this.wavesContainer, width, cx, cy, info.trackColor, info.trackVolume);\n  }\n\n  hide(name) {\n    remove(name, this.circles);\n    remove(name, this.albums);\n    remove(name, this.refLines);\n  }\n\n  resizeSvg() {\n    // TODO: create a resize function that only changes the svg viewBox\n    this.setup();\n  }\n\n  setup() {\n    this.display.clear();\n    this.display.createSvg();\n    const backgroundWidth = this.display.dimensions.width;\n    const albumsHeight = getAlbumHeight(backgroundWidth);\n    const backgroundHeight = this.display.dimensions.height - albumsHeight;\n    const svg = this.display.svg;\n    this.backgroundContainer = createGroup(svg, \"background\", albumsHeight);\n    this.albumsContainer = createGroup(svg, \"albums\", 0);\n    this.refLinesContainer = createGroup(svg, \"refLines\", albumsHeight);\n    this.circlesContainer = createGroup(svg, \"circles\", albumsHeight);\n    this.wavesContainer = createGroup(svg, \"waves\", albumsHeight);\n\n    if (this.mode === \"map\") {\n      drawMap(this.backgroundContainer, this.countries, backgroundWidth, backgroundHeight, this.set.visuals.geomap);\n    } else {\n      drawPanel(this.backgroundContainer, backgroundWidth, backgroundHeight, this.set.visuals.image.url);\n    }\n  }\n\n}\n\nfunction createGroup(svg, id, height) {\n  return svg.append(\"g\").attr(\"id\", id).attr(\"transform\", \"translate(0, \".concat(height, \")\"));\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/visuals/visuals.js"],"names":["topojson","getAlbumHeight","drawCircle","drawAlbum","drawRefLine","drawWave","drawMap","calculateMapScale","createMapProjector","drawPanel","createPanelProjector","getAlbumInfo","remove","name","group","value","Visuals","constructor","set","display","circles","albums","refLines","mode","visuals","setGeodata","geodata","countries","feature","objects","features","filter","country","id","setup","show","dimensions","width","height","geomap","scaleFactor","center","albumsHeight","scale","info","projector","image","size","position","cx","cy","circle","circlesContainer","album","albumsContainer","refLine","refLinesContainer","trackNumber","trackColor","wavesContainer","trackVolume","hide","resizeSvg","clear","createSvg","backgroundWidth","backgroundHeight","svg","backgroundContainer","createGroup","url","append","attr"],"mappings":";AAAA,OAAO,KAAKA,QAAZ,MAA0B,UAA1B;AAEA,SAASC,cAAT,QAA+B,cAA/B;AAEA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,OAAT,EAAkBC,iBAAlB,EAAqCC,kBAArC,QAA+D,WAA/D;AACA,SAASC,SAAT,EAAoBC,oBAApB,QAAgD,aAAhD;AACA,OAAOC,YAAP,MAAyB,gBAAzB;;AAEA,MAAMC,MAAM,GAAG,CAACC,IAAD,EAAOC,KAAP,KAAiB;AAC9B,QAAMC,KAAK,GAAGD,KAAK,CAACD,IAAD,CAAnB;;AACA,MAAIE,KAAJ,EAAW;AACTA,IAAAA,KAAK,CAACH,MAAN;AACAE,IAAAA,KAAK,CAACD,IAAD,CAAL,GAAc,IAAd;AACD;AACF,CAND;AAQA;;;;;AAGA,eAAe,MAAMG,OAAN,CAAc;AAC3BC,EAAAA,WAAW,CAACC,GAAD,EAAMC,OAAN,EAAe;AACxB,SAAKD,GAAL,GAAWA,GAAX;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,IAAL,GAAYL,GAAG,CAACM,OAAJ,CAAYD,IAAxB;AACD;;AAEDE,EAAAA,UAAU,CAACC,OAAD,EAAU;AAClB,SAAKC,SAAL,GAAiB3B,QAAQ,CACtB4B,OADc,CACNF,OADM,EACGA,OAAO,CAACG,OAAR,CAAgBF,SADnB,EAEdG,QAFc,CAELC,MAFK,CAEEC,OAAO,IAAIA,OAAO,CAACC,EAAR,KAAe,KAF5B,CAAjB;AAGA,SAAKC,KAAL;AACD;;AAEDC,EAAAA,IAAI,CAACtB,IAAD,EAAO;AACT;AACA;AAFS,kCAGiB,KAAKM,OAAL,CAAaiB,UAH9B;AAAA,UAGDC,KAHC,yBAGDA,KAHC;AAAA,UAGMC,MAHN,yBAGMA,MAHN;AAAA,kCAIuB,KAAKpB,GAAL,CAASM,OAAT,CAAiBe,MAJxC;AAAA,UAIDC,WAJC,yBAIDA,WAJC;AAAA,UAIYC,MAJZ,yBAIYA,MAJZ;AAKT,UAAMC,YAAY,GAAGzC,cAAc,CAACoC,KAAD,CAAnC;AAEA,UAAMM,KAAK,GAAGpC,iBAAiB,CAAC8B,KAAD,EAAQC,MAAM,GAAGI,YAAjB,CAA/B;AAEA,UAAME,IAAI,GAAGjC,YAAY,CAAC,KAAKO,GAAN,EAAWL,IAAX,CAAzB;AACA,QAAI,CAAC+B,IAAL,EAAW;AAEX,UAAMC,SAAS,GACb,KAAKtB,IAAL,KAAc,KAAd,GACIf,kBAAkB,CAChB6B,KADgB,EAEhBC,MAAM,GAAGI,YAFO,EAGhBF,WAAW,GAAGG,KAHE,EAIhBF,MAJgB,CADtB,GAOI/B,oBAAoB,CAClB2B,KADkB,EAElBC,MAAM,GAAGI,YAFS,EAGlB,KAAKxB,GAAL,CAASM,OAAT,CAAiBsB,KAAjB,CAAuBC,IAAvB,CAA4BV,KAHV,EAIlB,KAAKnB,GAAL,CAASM,OAAT,CAAiBsB,KAAjB,CAAuBC,IAAvB,CAA4BT,MAJV,CAR1B;;AAZS,uBA2BQO,SAAS,CAACD,IAAI,CAACI,QAAN,CA3BjB;AAAA;AAAA,UA2BFC,EA3BE;AAAA,UA2BEC,EA3BF,mBA6BT;;;AACA,UAAMC,MAAM,GAAGjD,UAAU,CAAC,KAAKkD,gBAAN,EAAwBf,KAAxB,EAA+BY,EAA/B,EAAmCC,EAAnC,EAAuCN,IAAvC,CAAzB;AACA,SAAKxB,OAAL,CAAaP,IAAb,IAAqBsC,MAArB;AAEA,UAAME,KAAK,GAAGlD,SAAS,CAAC,KAAKmD,eAAN,EAAuBjB,KAAvB,EAA8BO,IAA9B,CAAvB;AACA,SAAKvB,MAAL,CAAYR,IAAZ,IAAoBwC,KAApB;AAEA,UAAME,OAAO,GAAGnD,WAAW,CACzB,KAAKoD,iBADoB,EAEzBnB,KAFyB,EAGzBY,EAHyB,EAIzBC,EAJyB,EAKzBN,IAAI,CAACa,WALoB,EAMzBb,IAAI,CAACc,UANoB,CAA3B;AAQA,SAAKpC,QAAL,CAAcT,IAAd,IAAsB0C,OAAtB;AAEAlD,IAAAA,QAAQ,CACN,KAAKsD,cADC,EAENtB,KAFM,EAGNY,EAHM,EAINC,EAJM,EAKNN,IAAI,CAACc,UALC,EAMNd,IAAI,CAACgB,WANC,CAAR;AAQD;;AAEDC,EAAAA,IAAI,CAAChD,IAAD,EAAO;AACTD,IAAAA,MAAM,CAACC,IAAD,EAAO,KAAKO,OAAZ,CAAN;AACAR,IAAAA,MAAM,CAACC,IAAD,EAAO,KAAKQ,MAAZ,CAAN;AACAT,IAAAA,MAAM,CAACC,IAAD,EAAO,KAAKS,QAAZ,CAAN;AACD;;AAEDwC,EAAAA,SAAS,GAAG;AACV;AACA,SAAK5B,KAAL;AACD;;AAEDA,EAAAA,KAAK,GAAG;AACN,SAAKf,OAAL,CAAa4C,KAAb;AACA,SAAK5C,OAAL,CAAa6C,SAAb;AAEA,UAAMC,eAAe,GAAG,KAAK9C,OAAL,CAAaiB,UAAb,CAAwBC,KAAhD;AACA,UAAMK,YAAY,GAAGzC,cAAc,CAACgE,eAAD,CAAnC;AACA,UAAMC,gBAAgB,GAAG,KAAK/C,OAAL,CAAaiB,UAAb,CAAwBE,MAAxB,GAAiCI,YAA1D;AAEA,UAAMyB,GAAG,GAAG,KAAKhD,OAAL,CAAagD,GAAzB;AAEA,SAAKC,mBAAL,GAA2BC,WAAW,CAACF,GAAD,EAAM,YAAN,EAAoBzB,YAApB,CAAtC;AACA,SAAKY,eAAL,GAAuBe,WAAW,CAACF,GAAD,EAAM,QAAN,EAAgB,CAAhB,CAAlC;AACA,SAAKX,iBAAL,GAAyBa,WAAW,CAACF,GAAD,EAAM,UAAN,EAAkBzB,YAAlB,CAApC;AACA,SAAKU,gBAAL,GAAwBiB,WAAW,CAACF,GAAD,EAAM,SAAN,EAAiBzB,YAAjB,CAAnC;AACA,SAAKiB,cAAL,GAAsBU,WAAW,CAACF,GAAD,EAAM,OAAN,EAAezB,YAAf,CAAjC;;AAEA,QAAI,KAAKnB,IAAL,KAAc,KAAlB,EAAyB;AACvBjB,MAAAA,OAAO,CACL,KAAK8D,mBADA,EAEL,KAAKzC,SAFA,EAGLsC,eAHK,EAILC,gBAJK,EAKL,KAAKhD,GAAL,CAASM,OAAT,CAAiBe,MALZ,CAAP;AAOD,KARD,MAQO;AACL9B,MAAAA,SAAS,CACP,KAAK2D,mBADE,EAEPH,eAFO,EAGPC,gBAHO,EAIP,KAAKhD,GAAL,CAASM,OAAT,CAAiBsB,KAAjB,CAAuBwB,GAJhB,CAAT;AAMD;AACF;;AApH0B;;AAuH7B,SAASD,WAAT,CAAqBF,GAArB,EAA0BlC,EAA1B,EAA8BK,MAA9B,EAAsC;AACpC,SAAO6B,GAAG,CACPI,MADI,CACG,GADH,EAEJC,IAFI,CAEC,IAFD,EAEOvC,EAFP,EAGJuC,IAHI,CAGC,WAHD,yBAG8BlC,MAH9B,OAAP;AAID","sourcesContent":["import * as topojson from \"topojson\";\n\nimport { getAlbumHeight } from \"./dimensions\";\n\nimport drawCircle from \"./drawCircle\";\nimport drawAlbum from \"./drawAlbum\";\nimport drawRefLine from \"./drawRefLine\";\nimport drawWave from \"./drawWave\";\nimport { drawMap, calculateMapScale, createMapProjector } from \"./drawMap\";\nimport { drawPanel, createPanelProjector } from \"./drawPanel\";\nimport getAlbumInfo from \"./getAlbumInfo\";\n\nconst remove = (name, group) => {\n  const value = group[name];\n  if (value) {\n    value.remove();\n    group[name] = null;\n  }\n};\n\n/**\n * It stores the state required to render visualizations\n */\nexport default class Visuals {\n  constructor(set, display) {\n    this.set = set;\n    this.display = display;\n    this.circles = {};\n    this.albums = {};\n    this.refLines = {};\n    this.mode = set.visuals.mode;\n  }\n\n  setGeodata(geodata) {\n    this.countries = topojson\n      .feature(geodata, geodata.objects.countries)\n      .features.filter(country => country.id !== \"010\");\n    this.setup();\n  }\n\n  show(name) {\n    // REVIEW: See if there is a better way to get this info (scale, projection)\n    // that is already calculated in drawMap\n    const { width, height } = this.display.dimensions;\n    const { scaleFactor, center } = this.set.visuals.geomap;\n    const albumsHeight = getAlbumHeight(width);\n\n    const scale = calculateMapScale(width, height - albumsHeight);\n\n    const info = getAlbumInfo(this.set, name);\n    if (!info) return;\n\n    const projector =\n      this.mode === \"map\"\n        ? createMapProjector(\n            width,\n            height - albumsHeight,\n            scaleFactor * scale,\n            center\n          )\n        : createPanelProjector(\n            width,\n            height - albumsHeight,\n            this.set.visuals.image.size.width,\n            this.set.visuals.image.size.height\n          );\n\n    const [cx, cy] = projector(info.position);\n\n    // REVIEW: fix width parameter to draw circles with the proper size\n    const circle = drawCircle(this.circlesContainer, width, cx, cy, info);\n    this.circles[name] = circle;\n\n    const album = drawAlbum(this.albumsContainer, width, info);\n    this.albums[name] = album;\n\n    const refLine = drawRefLine(\n      this.refLinesContainer,\n      width,\n      cx,\n      cy,\n      info.trackNumber,\n      info.trackColor\n    );\n    this.refLines[name] = refLine;\n\n    drawWave(\n      this.wavesContainer,\n      width,\n      cx,\n      cy,\n      info.trackColor,\n      info.trackVolume\n    );\n  }\n\n  hide(name) {\n    remove(name, this.circles);\n    remove(name, this.albums);\n    remove(name, this.refLines);\n  }\n\n  resizeSvg() {\n    // TODO: create a resize function that only changes the svg viewBox\n    this.setup();\n  }\n\n  setup() {\n    this.display.clear();\n    this.display.createSvg();\n\n    const backgroundWidth = this.display.dimensions.width;\n    const albumsHeight = getAlbumHeight(backgroundWidth);\n    const backgroundHeight = this.display.dimensions.height - albumsHeight;\n\n    const svg = this.display.svg;\n\n    this.backgroundContainer = createGroup(svg, \"background\", albumsHeight);\n    this.albumsContainer = createGroup(svg, \"albums\", 0);\n    this.refLinesContainer = createGroup(svg, \"refLines\", albumsHeight);\n    this.circlesContainer = createGroup(svg, \"circles\", albumsHeight);\n    this.wavesContainer = createGroup(svg, \"waves\", albumsHeight);\n\n    if (this.mode === \"map\") {\n      drawMap(\n        this.backgroundContainer,\n        this.countries,\n        backgroundWidth,\n        backgroundHeight,\n        this.set.visuals.geomap\n      );\n    } else {\n      drawPanel(\n        this.backgroundContainer,\n        backgroundWidth,\n        backgroundHeight,\n        this.set.visuals.image.url\n      );\n    }\n  }\n}\n\nfunction createGroup(svg, id, height) {\n  return svg\n    .append(\"g\")\n    .attr(\"id\", id)\n    .attr(\"transform\", `translate(0, ${height})`);\n}\n"]},"metadata":{},"sourceType":"module"}