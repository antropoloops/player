{"ast":null,"code":"export class KeyboardControler {\n  constructor(audioset, control) {\n    this.control = control;\n    this.active = false;\n    this.pressed = {};\n    this.clipIdToKey = {};\n    this.keyToClipId = {};\n    this.mapMode = false;\n    audioset.clips.forEach(clip => {\n      const key = clip.keyMap.toUpperCase();\n      this.clipIdToKey[clip.id] = key;\n      this.keyToClipId[key] = clip.id;\n    });\n  }\n\n  setMapMode(clipId, callback) {\n    this.mapMode = true;\n  }\n\n  setKey(clipId, key) {\n    const oldKey = this.clipIdToKey[clipId];\n\n    if (oldKey) {\n      this.keyToClipId[oldKey] = undefined;\n    }\n\n    key = key.toUpperCase();\n    this.keyToClipId[key] = clipId;\n    this.clipIdToKey[clipId] = key;\n  }\n\n  keyDown(key) {\n    if (!this.active) {\n      return;\n    }\n\n    key = key.toUpperCase();\n\n    if (this.pressed[key]) {\n      return;\n    }\n\n    this.pressed[key] = true;\n    const clipId = this.keyToClipId[key];\n\n    if (clipId) {\n      this.control.startClip(clipId, 0);\n    }\n  }\n\n  keyUp(key) {\n    if (!this.active) {\n      return;\n    }\n\n    key = key.toUpperCase();\n    this.pressed[key] = false;\n    const clipId = this.keyToClipId[key];\n\n    if (clipId) {\n      this.control.stopClip(clipId, 0);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/player/KeyboardControler.ts"],"names":["KeyboardControler","constructor","audioset","control","active","pressed","clipIdToKey","keyToClipId","mapMode","clips","forEach","clip","key","keyMap","toUpperCase","id","setMapMode","clipId","callback","setKey","oldKey","undefined","keyDown","startClip","keyUp","stopClip"],"mappings":"AASA,OAAO,MAAMA,iBAAN,CAAwB;AAO7BC,EAAAA,WAAW,CAACC,QAAD,EAA6BC,OAA7B,EAA+C;AAAA,SAAlBA,OAAkB,GAAlBA,OAAkB;AAAA,SANnDC,MAMmD,GANjC,KAMiC;AAAA,SALnDC,OAKmD,GALhB,EAKgB;AAAA,SAJnDC,WAImD,GAJb,EAIa;AAAA,SAHnDC,WAGmD,GAHD,EAGC;AAAA,SAFlDC,OAEkD,GAF/B,KAE+B;AACxDN,IAAAA,QAAQ,CAACO,KAAT,CAAeC,OAAf,CAAuBC,IAAI,IAAI;AAC7B,YAAMC,GAAG,GAAGD,IAAI,CAACE,MAAL,CAAYC,WAAZ,EAAZ;AACA,WAAKR,WAAL,CAAiBK,IAAI,CAACI,EAAtB,IAA4BH,GAA5B;AACA,WAAKL,WAAL,CAAiBK,GAAjB,IAAwBD,IAAI,CAACI,EAA7B;AACD,KAJD;AAKD;;AAEMC,EAAAA,UAAP,CAAkBC,MAAlB,EAAkCC,QAAlC,EAAsE;AACpE,SAAKV,OAAL,GAAe,IAAf;AACD;;AAEMW,EAAAA,MAAP,CAAcF,MAAd,EAA8BL,GAA9B,EAA2C;AACzC,UAAMQ,MAAM,GAAG,KAAKd,WAAL,CAAiBW,MAAjB,CAAf;;AACA,QAAIG,MAAJ,EAAY;AACV,WAAKb,WAAL,CAAiBa,MAAjB,IAA2BC,SAA3B;AACD;;AACDT,IAAAA,GAAG,GAAGA,GAAG,CAACE,WAAJ,EAAN;AACA,SAAKP,WAAL,CAAiBK,GAAjB,IAAwBK,MAAxB;AACA,SAAKX,WAAL,CAAiBW,MAAjB,IAA2BL,GAA3B;AACD;;AAEMU,EAAAA,OAAP,CAAeV,GAAf,EAA4B;AAC1B,QAAI,CAAC,KAAKR,MAAV,EAAkB;AAChB;AACD;;AAEDQ,IAAAA,GAAG,GAAGA,GAAG,CAACE,WAAJ,EAAN;;AACA,QAAI,KAAKT,OAAL,CAAaO,GAAb,CAAJ,EAAuB;AACrB;AACD;;AACD,SAAKP,OAAL,CAAaO,GAAb,IAAoB,IAApB;AAEA,UAAMK,MAAM,GAAG,KAAKV,WAAL,CAAiBK,GAAjB,CAAf;;AACA,QAAIK,MAAJ,EAAY;AACV,WAAKd,OAAL,CAAaoB,SAAb,CAAuBN,MAAvB,EAA+B,CAA/B;AACD;AACF;;AACMO,EAAAA,KAAP,CAAaZ,GAAb,EAA0B;AACxB,QAAI,CAAC,KAAKR,MAAV,EAAkB;AAChB;AACD;;AAEDQ,IAAAA,GAAG,GAAGA,GAAG,CAACE,WAAJ,EAAN;AACA,SAAKT,OAAL,CAAaO,GAAb,IAAoB,KAApB;AAEA,UAAMK,MAAM,GAAG,KAAKV,WAAL,CAAiBK,GAAjB,CAAf;;AACA,QAAIK,MAAJ,EAAY;AACV,WAAKd,OAAL,CAAasB,QAAb,CAAsBR,MAAtB,EAA8B,CAA9B;AACD;AACF;;AAzD4B","sourcesContent":["import { Audioset } from \"../audioset\";\n\nexport interface Control {\n  startClip(clipId: string, time: number): void;\n  stopClip(clipId: string, time: number): void;\n}\n\ntype MapModeCallback = (newKey: string) => void;\n\nexport class KeyboardControler {\n  public active: boolean = false;\n  public pressed: Record<string, boolean> = {};\n  public clipIdToKey: Record<string, string> = {};\n  public keyToClipId: Record<string, string | undefined> = {};\n  private mapMode: boolean = false;\n\n  constructor(audioset: Audioset, private control: Control) {\n    audioset.clips.forEach(clip => {\n      const key = clip.keyMap.toUpperCase();\n      this.clipIdToKey[clip.id] = key;\n      this.keyToClipId[key] = clip.id;\n    });\n  }\n\n  public setMapMode(clipId: string, callback: (newKey: string) => void) {\n    this.mapMode = true;\n  }\n\n  public setKey(clipId: string, key: string) {\n    const oldKey = this.clipIdToKey[clipId];\n    if (oldKey) {\n      this.keyToClipId[oldKey] = undefined;\n    }\n    key = key.toUpperCase();\n    this.keyToClipId[key] = clipId;\n    this.clipIdToKey[clipId] = key;\n  }\n\n  public keyDown(key: string) {\n    if (!this.active) {\n      return;\n    }\n\n    key = key.toUpperCase();\n    if (this.pressed[key]) {\n      return;\n    }\n    this.pressed[key] = true;\n\n    const clipId = this.keyToClipId[key];\n    if (clipId) {\n      this.control.startClip(clipId, 0);\n    }\n  }\n  public keyUp(key: string) {\n    if (!this.active) {\n      return;\n    }\n\n    key = key.toUpperCase();\n    this.pressed[key] = false;\n\n    const clipId = this.keyToClipId[key];\n    if (clipId) {\n      this.control.stopClip(clipId, 0);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}