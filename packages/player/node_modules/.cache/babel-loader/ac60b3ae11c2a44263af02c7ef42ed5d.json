{"ast":null,"code":"// Extracts the lines and rings from the specified hash of geometry objects.\n//\n// Returns an object with three properties:\n//\n// * coordinates - shared buffer of [x, y] coordinates\n// * lines - lines extracted from the hash, of the form [start, end]\n// * rings - rings extracted from the hash, of the form [start, end]\n//\n// For each ring or line, start and end represent inclusive indexes into the\n// coordinates buffer. For rings (and closed lines), coordinates[start] equals\n// coordinates[end].\n//\n// For each line or polygon geometry in the input hash, including nested\n// geometries as in geometry collections, the `coordinates` array is replaced\n// with an equivalent `arcs` array that, for each line (for line string\n// geometries) or ring (for polygon geometries), points to one of the above\n// lines or rings.\nexport default function (objects) {\n  var index = -1,\n      lines = [],\n      rings = [],\n      coordinates = [];\n\n  function extractGeometry(geometry) {\n    if (geometry && extractGeometryType.hasOwnProperty(geometry.type)) extractGeometryType[geometry.type](geometry);\n  }\n\n  var extractGeometryType = {\n    GeometryCollection: function GeometryCollection(o) {\n      o.geometries.forEach(extractGeometry);\n    },\n    LineString: function LineString(o) {\n      o.arcs = extractLine(o.arcs);\n    },\n    MultiLineString: function MultiLineString(o) {\n      o.arcs = o.arcs.map(extractLine);\n    },\n    Polygon: function Polygon(o) {\n      o.arcs = o.arcs.map(extractRing);\n    },\n    MultiPolygon: function MultiPolygon(o) {\n      o.arcs = o.arcs.map(extractMultiRing);\n    }\n  };\n\n  function extractLine(line) {\n    for (var i = 0, n = line.length; i < n; ++i) {\n      coordinates[++index] = line[i];\n    }\n\n    var arc = {\n      0: index - n + 1,\n      1: index\n    };\n    lines.push(arc);\n    return arc;\n  }\n\n  function extractRing(ring) {\n    for (var i = 0, n = ring.length; i < n; ++i) {\n      coordinates[++index] = ring[i];\n    }\n\n    var arc = {\n      0: index - n + 1,\n      1: index\n    };\n    rings.push(arc);\n    return arc;\n  }\n\n  function extractMultiRing(rings) {\n    return rings.map(extractRing);\n  }\n\n  for (var key in objects) {\n    extractGeometry(objects[key]);\n  }\n\n  return {\n    type: \"Topology\",\n    coordinates: coordinates,\n    lines: lines,\n    rings: rings,\n    objects: objects\n  };\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/node_modules/topojson/node_modules/topojson-server/src/extract.js"],"names":["objects","index","lines","rings","coordinates","extractGeometry","geometry","extractGeometryType","hasOwnProperty","type","GeometryCollection","o","geometries","forEach","LineString","arcs","extractLine","MultiLineString","map","Polygon","extractRing","MultiPolygon","extractMultiRing","line","i","n","length","arc","push","ring","key"],"mappings":"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","sourcesContent":["// Extracts the lines and rings from the specified hash of geometry objects.\n//\n// Returns an object with three properties:\n//\n// * coordinates - shared buffer of [x, y] coordinates\n// * lines - lines extracted from the hash, of the form [start, end]\n// * rings - rings extracted from the hash, of the form [start, end]\n//\n// For each ring or line, start and end represent inclusive indexes into the\n// coordinates buffer. For rings (and closed lines), coordinates[start] equals\n// coordinates[end].\n//\n// For each line or polygon geometry in the input hash, including nested\n// geometries as in geometry collections, the `coordinates` array is replaced\n// with an equivalent `arcs` array that, for each line (for line string\n// geometries) or ring (for polygon geometries), points to one of the above\n// lines or rings.\nexport default function(objects) {\n  var index = -1,\n      lines = [],\n      rings = [],\n      coordinates = [];\n\n  function extractGeometry(geometry) {\n    if (geometry && extractGeometryType.hasOwnProperty(geometry.type)) extractGeometryType[geometry.type](geometry);\n  }\n\n  var extractGeometryType = {\n    GeometryCollection: function(o) { o.geometries.forEach(extractGeometry); },\n    LineString: function(o) { o.arcs = extractLine(o.arcs); },\n    MultiLineString: function(o) { o.arcs = o.arcs.map(extractLine); },\n    Polygon: function(o) { o.arcs = o.arcs.map(extractRing); },\n    MultiPolygon: function(o) { o.arcs = o.arcs.map(extractMultiRing); }\n  };\n\n  function extractLine(line) {\n    for (var i = 0, n = line.length; i < n; ++i) coordinates[++index] = line[i];\n    var arc = {0: index - n + 1, 1: index};\n    lines.push(arc);\n    return arc;\n  }\n\n  function extractRing(ring) {\n    for (var i = 0, n = ring.length; i < n; ++i) coordinates[++index] = ring[i];\n    var arc = {0: index - n + 1, 1: index};\n    rings.push(arc);\n    return arc;\n  }\n\n  function extractMultiRing(rings) {\n    return rings.map(extractRing);\n  }\n\n  for (var key in objects) {\n    extractGeometry(objects[key]);\n  }\n\n  return {\n    type: \"Topology\",\n    coordinates: coordinates,\n    lines: lines,\n    rings: rings,\n    objects: objects\n  };\n}\n"]},"metadata":{},"sourceType":"module"}