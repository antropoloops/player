{"ast":null,"code":"import { addResizeObserver } from \"./addResizeObserver\";\nimport Display from \"./display\";\nimport Visuals from \"./visuals\";\nexport class VisualControl {\n  constructor(audioset, el) {\n    this.display = void 0;\n    this.visuals = void 0;\n    this.detachers = [];\n    this.display = new Display(el);\n    this.visuals = new Visuals(audioset, this.display);\n    setupVisuals(audioset, this.visuals).then(() => {\n      this.detachers.push(addResizeObserver(el, (width, height) => {\n        this.visuals.resizeSvg(width, height);\n      }));\n    });\n  }\n\n  run({\n    command,\n    clipId\n  }) {\n    switch (command) {\n      case \"startClip\":\n        return this.startClip(clipId);\n\n      case \"stopClip\":\n        return this.stopClip(clipId);\n    }\n  }\n\n  startClip(clipId) {\n    this.visuals.show(clipId);\n  }\n\n  stopClip(clipId) {\n    this.visuals.hide(clipId);\n  }\n\n  detach() {\n    for (const detach of this.detachers) {\n      detach();\n    }\n  }\n\n}\n\nfunction setupVisuals(audioset, visuals) {\n  if (audioset.visuals.mode === \"map\") {\n    return fetch(audioset.visuals.geomap.url).then(response => response.json()).then(data => visuals.setGeodata(data)).then(() => visuals);\n  } else {\n    visuals.setup();\n    return Promise.resolve(visuals);\n  }\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/visuals/index.ts"],"names":["addResizeObserver","Display","Visuals","VisualControl","constructor","audioset","el","display","visuals","detachers","setupVisuals","then","push","width","height","resizeSvg","run","command","clipId","startClip","stopClip","show","hide","detach","mode","fetch","geomap","url","response","json","data","setGeodata","setup","Promise","resolve"],"mappings":"AACA,SAASA,iBAAT,QAAkC,qBAAlC;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,OAAP,MAAoB,WAApB;AAQA,OAAO,MAAMC,aAAN,CAAoB;AAKzBC,EAAAA,WAAW,CAACC,QAAD,EAAqBC,EAArB,EAA8B;AAAA,SAJjCC,OAIiC;AAAA,SAHjCC,OAGiC;AAAA,SAFjCC,SAEiC,GAFF,EAEE;AACvC,SAAKF,OAAL,GAAe,IAAIN,OAAJ,CAAYK,EAAZ,CAAf;AACA,SAAKE,OAAL,GAAe,IAAIN,OAAJ,CAAYG,QAAZ,EAAsB,KAAKE,OAA3B,CAAf;AACAG,IAAAA,YAAY,CAACL,QAAD,EAAW,KAAKG,OAAhB,CAAZ,CAAqCG,IAArC,CAA0C,MAAM;AAC9C,WAAKF,SAAL,CAAeG,IAAf,CACEZ,iBAAiB,CAACM,EAAD,EAAK,CAACO,KAAD,EAAgBC,MAAhB,KAAmC;AACvD,aAAKN,OAAL,CAAaO,SAAb,CAAuBF,KAAvB,EAA8BC,MAA9B;AACD,OAFgB,CADnB;AAKD,KAND;AAOD;;AAEME,EAAAA,GAAP,CAAW;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,GAAX,EAAgD;AAC9C,YAAQD,OAAR;AACE,WAAK,WAAL;AACE,eAAO,KAAKE,SAAL,CAAeD,MAAf,CAAP;;AACF,WAAK,UAAL;AACE,eAAO,KAAKE,QAAL,CAAcF,MAAd,CAAP;AAJJ;AAMD;;AAEMC,EAAAA,SAAP,CAAiBD,MAAjB,EAAiC;AAC/B,SAAKV,OAAL,CAAaa,IAAb,CAAkBH,MAAlB;AACD;;AAEME,EAAAA,QAAP,CAAgBF,MAAhB,EAAgC;AAC9B,SAAKV,OAAL,CAAac,IAAb,CAAkBJ,MAAlB;AACD;;AAEMK,EAAAA,MAAP,GAAgB;AACd,SAAK,MAAMA,MAAX,IAAqB,KAAKd,SAA1B,EAAqC;AACnCc,MAAAA,MAAM;AACP;AACF;;AAtCwB;;AAyC3B,SAASb,YAAT,CAAsBL,QAAtB,EAA0CG,OAA1C,EAA8E;AAC5E,MAAIH,QAAQ,CAACG,OAAT,CAAiBgB,IAAjB,KAA0B,KAA9B,EAAqC;AACnC,WAAOC,KAAK,CAACpB,QAAQ,CAACG,OAAT,CAAiBkB,MAAjB,CAAwBC,GAAzB,CAAL,CACJhB,IADI,CACCiB,QAAQ,IAAIA,QAAQ,CAACC,IAAT,EADb,EAEJlB,IAFI,CAECmB,IAAI,IAAItB,OAAO,CAACuB,UAAR,CAAmBD,IAAnB,CAFT,EAGJnB,IAHI,CAGC,MAAMH,OAHP,CAAP;AAID,GALD,MAKO;AACLA,IAAAA,OAAO,CAACwB,KAAR;AACA,WAAOC,OAAO,CAACC,OAAR,CAAgB1B,OAAhB,CAAP;AACD;AACF","sourcesContent":["import { Audioset } from \"../audioset\";\nimport { addResizeObserver } from \"./addResizeObserver\";\nimport Display from \"./display\";\nimport Visuals from \"./visuals\";\nimport { ControlCommand } from \"../player/Control\";\n\ninterface Command {\n  command: string;\n  clipId: string;\n}\n\nexport class VisualControl {\n  private display: Display;\n  private visuals: Visuals;\n  private detachers: Array<() => void> = [];\n\n  constructor(audioset: Audioset, el: any) {\n    this.display = new Display(el);\n    this.visuals = new Visuals(audioset, this.display);\n    setupVisuals(audioset, this.visuals).then(() => {\n      this.detachers.push(\n        addResizeObserver(el, (width: number, height: number) => {\n          this.visuals.resizeSvg(width, height);\n        }),\n      );\n    });\n  }\n\n  public run({ command, clipId }: ControlCommand) {\n    switch (command) {\n      case \"startClip\":\n        return this.startClip(clipId);\n      case \"stopClip\":\n        return this.stopClip(clipId);\n    }\n  }\n\n  public startClip(clipId: string) {\n    this.visuals.show(clipId);\n  }\n\n  public stopClip(clipId: string) {\n    this.visuals.hide(clipId);\n  }\n\n  public detach() {\n    for (const detach of this.detachers) {\n      detach();\n    }\n  }\n}\n\nfunction setupVisuals(audioset: Audioset, visuals: Visuals): Promise<Visuals> {\n  if (audioset.visuals.mode === \"map\") {\n    return fetch(audioset.visuals.geomap.url)\n      .then(response => response.json())\n      .then(data => visuals.setGeodata(data))\n      .then(() => visuals);\n  } else {\n    visuals.setup();\n    return Promise.resolve(visuals);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}