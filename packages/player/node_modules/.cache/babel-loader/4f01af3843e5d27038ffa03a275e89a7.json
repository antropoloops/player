{"ast":null,"code":"import{getCoverSize,getHorizontalPadding,getVerticalPadding,getInfoHeight}from\"./dimensions\";export default function drawAlbum(el,width,clip){var trackNumber=clip.trackNum;var imageUrl=clip.resources.cover.small;var country=clip.country;var trackColor=clip.color;var album=el.append(\"g\");var coverSize=getCoverSize(width);var horizontalPadding=getHorizontalPadding(width);var verticalPadding=getVerticalPadding(width);var infoHeight=getInfoHeight(width);var fontSize=\"1.1vw\";album.append(\"svg:image\").attr(\"width\",coverSize).attr(\"height\",coverSize).attr(\"x\",trackNumber*coverSize).attr(\"y\",0).style(\"stroke\",\"white\").attr(\"xlink:href\",imageUrl);// Draw country rectangle\nalbum.append(\"rect\").attr(\"width\",coverSize).attr(\"height\",infoHeight).attr(\"x\",trackNumber*coverSize).attr(\"y\",coverSize+verticalPadding).style(\"fill\",trackColor);// Draw country text\nvar countryText=album.append(\"text\").attr(\"id\",\"countryText\"+trackNumber).attr(\"x\",trackNumber*coverSize+horizontalPadding).attr(\"y\",coverSize+verticalPadding+infoHeight/2).attr(\"dy\",\"0.35em\").style(\"font-size\",fontSize).text(country);// Trucate text larger than coverSize\nvar countryTextId=\"countryText\"+trackNumber;function wrap(textElement,textId){// FIXME: don't use document\nvar danger=document.getElementById(textId);if(!danger)return;var textLength=danger.getBBox().width;var text=textElement.text();while(textLength>coverSize-horizontalPadding*2&&text.length>0){text=text.slice(0,-1);textElement.text(text+\"...\");textLength=danger.getBBox().width;}}wrap(countryText,countryTextId);return album;}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/visuals/drawAlbum.ts"],"names":["getCoverSize","getHorizontalPadding","getVerticalPadding","getInfoHeight","drawAlbum","el","width","clip","trackNumber","trackNum","imageUrl","resources","cover","small","country","trackColor","color","album","append","coverSize","horizontalPadding","verticalPadding","infoHeight","fontSize","attr","style","countryText","text","countryTextId","wrap","textElement","textId","danger","document","getElementById","textLength","getBBox","length","slice"],"mappings":"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","sourcesContent":["import { getCoverSize, getHorizontalPadding, getVerticalPadding, getInfoHeight } from \"./dimensions\";\nimport { Clip } from \"../Audioset\";\n\nexport default function drawAlbum(el: any, width: number, clip: Clip) {\n  const trackNumber = clip.trackNum;\n  const imageUrl = clip.resources.cover.small;\n  const country = clip.country;\n  const trackColor = clip.color;\n  const album = el.append(\"g\");\n  const coverSize = getCoverSize(width);\n  const horizontalPadding = getHorizontalPadding(width);\n  const verticalPadding = getVerticalPadding(width);\n  const infoHeight = getInfoHeight(width);\n  const fontSize = \"1.1vw\";\n\n  album\n    .append(\"svg:image\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", coverSize)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", 0)\n    .style(\"stroke\", \"white\")\n    .attr(\"xlink:href\", imageUrl);\n\n  // Draw country rectangle\n  album\n    .append(\"rect\")\n    .attr(\"width\", coverSize)\n    .attr(\"height\", infoHeight)\n    .attr(\"x\", trackNumber * coverSize)\n    .attr(\"y\", coverSize + verticalPadding)\n    .style(\"fill\", trackColor);\n\n  // Draw country text\n  const countryText = album\n    .append(\"text\")\n    .attr(\"id\", \"countryText\" + trackNumber)\n    .attr(\"x\", trackNumber * coverSize + horizontalPadding)\n    .attr(\"y\", coverSize + verticalPadding + infoHeight / 2)\n    .attr(\"dy\", \"0.35em\")\n    .style(\"font-size\", fontSize)\n    .text(country);\n\n  // Trucate text larger than coverSize\n  const countryTextId = \"countryText\" + trackNumber;\n\n  function wrap(textElement: any, textId: any) {\n    // FIXME: don't use document\n    const danger = document.getElementById(textId) as any;\n    if (!danger) return;\n    let textLength = danger.getBBox().width;\n    let text = textElement.text();\n\n    while (textLength > coverSize - horizontalPadding * 2 && text.length > 0) {\n      text = text.slice(0, -1);\n      textElement.text(text + \"...\");\n      textLength = danger.getBBox().width;\n    }\n  }\n  wrap(countryText, countryTextId);\n\n  return album;\n}\n"]},"metadata":{},"sourceType":"module"}