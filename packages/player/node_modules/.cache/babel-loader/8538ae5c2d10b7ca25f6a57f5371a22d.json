{"ast":null,"code":"import debug from \"./node_modules/debug\";\nexport let context;\nconst log = debug(\"atpls:context\");\n/**\n * @see https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio\n */\n\nexport async function getAudioContext() {\n  context = context || createAudioContext();\n\n  if (context.state !== \"running\" && context.resume) {\n    log(\"waiting for context...\");\n    return context.resume().then(() => context);\n  } else {\n    return context;\n  }\n}\n\nfunction createAudioContext() {\n  log(\"create context\"); // iOS hack. See https://github.com/tambien/StartAudioContext/blob/master/StartAudioContext.js\n\n  const ctx = new (window.AudioContext || window.webkitAudioContext)();\n  const buffer = ctx.createBuffer(1, 1, ctx.sampleRate);\n  const source = ctx.createBufferSource();\n  source.buffer = buffer;\n  source.connect(ctx.destination);\n  source.start(0);\n  return ctx;\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/player/AudioContext.ts"],"names":["debug","context","log","getAudioContext","createAudioContext","state","resume","then","ctx","window","AudioContext","webkitAudioContext","buffer","createBuffer","sampleRate","source","createBufferSource","connect","destination","start"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,sBAAlB;AACA,OAAO,IAAIC,OAAJ;AAEP,MAAMC,GAAG,GAAGF,KAAK,CAAC,eAAD,CAAjB;AAEA;;;;AAGA,OAAO,eAAeG,eAAf,GAAwD;AAC7DF,EAAAA,OAAO,GAAGA,OAAO,IAAIG,kBAAkB,EAAvC;;AAEA,MAAIH,OAAO,CAACI,KAAR,KAAkB,SAAlB,IAA+BJ,OAAO,CAACK,MAA3C,EAAmD;AACjDJ,IAAAA,GAAG,CAAC,wBAAD,CAAH;AACA,WAAOD,OAAO,CAACK,MAAR,GAAiBC,IAAjB,CAAsB,MAAMN,OAA5B,CAAP;AACD,GAHD,MAGO;AACL,WAAOA,OAAP;AACD;AACF;;AAED,SAASG,kBAAT,GAA8B;AAC5BF,EAAAA,GAAG,CAAC,gBAAD,CAAH,CAD4B,CAE5B;;AACA,QAAMM,GAAG,GAAG,KAAMC,MAAD,CAAgBC,YAAhB,IACdD,MAAD,CAAgBE,kBADN,GAAZ;AAEA,QAAMC,MAAM,GAAGJ,GAAG,CAACK,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBL,GAAG,CAACM,UAA3B,CAAf;AACA,QAAMC,MAAM,GAAGP,GAAG,CAACQ,kBAAJ,EAAf;AACAD,EAAAA,MAAM,CAACH,MAAP,GAAgBA,MAAhB;AACAG,EAAAA,MAAM,CAACE,OAAP,CAAeT,GAAG,CAACU,WAAnB;AACAH,EAAAA,MAAM,CAACI,KAAP,CAAa,CAAb;AACA,SAAOX,GAAP;AACD","sourcesContent":["import debug from \"./node_modules/debug\";\nexport let context: AudioContext | undefined;\n\nconst log = debug(\"atpls:context\");\n\n/**\n * @see https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio\n */\nexport async function getAudioContext(): Promise<AudioContext> {\n  context = context || createAudioContext();\n\n  if (context.state !== \"running\" && context.resume) {\n    log(\"waiting for context...\");\n    return context.resume().then(() => context as AudioContext);\n  } else {\n    return context;\n  }\n}\n\nfunction createAudioContext() {\n  log(\"create context\");\n  // iOS hack. See https://github.com/tambien/StartAudioContext/blob/master/StartAudioContext.js\n  const ctx = new ((window as any).AudioContext ||\n    (window as any).webkitAudioContext)() as AudioContext;\n  const buffer = ctx.createBuffer(1, 1, ctx.sampleRate);\n  const source = ctx.createBufferSource();\n  source.buffer = buffer;\n  source.connect(ctx.destination);\n  source.start(0);\n  return ctx;\n}\n"]},"metadata":{},"sourceType":"module"}