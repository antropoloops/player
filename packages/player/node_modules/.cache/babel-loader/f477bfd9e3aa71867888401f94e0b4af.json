{"ast":null,"code":"import * as d3 from \"d3\";\n// Number of slices in a circle\nconst NUMSLICES = 36; // Scale. Get the degrees for a specific slice\n\nconst degreesFromSlice = d3.scaleLinear().range([0, 360]) // working in degrees\n.domain([0, NUMSLICES]); // Transform degrees into radians\n\nconst deg2rad = degrees => degrees * (Math.PI / 180);\n\nexport default function drawCircle(parent, width, cx, cy, clip) {\n  const duration = clip.audio.durationSeconds;\n  const trackColor = clip.color;\n  const trackVolume = clip.audio.volume;\n  const circlesGroup = parent.append(\"g\").attr(\"class\", \"circleGroup\").attr(\"transform\", \"translate(\".concat(cx, \", \").concat(cy, \")\")); // We need to group again, so that the circle turns in its location\n\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\"); // Arc generator\n\n  const arc = d3.arc(); // Create outerArcs data\n\n  const outerArcs = createOuterArcs(width, trackVolume); // Draw outerArcs\n\n  circle.selectAll(\".outerArcs\").data(outerArcs).enter().append(\"path\").attr(\"class\", \"outerArcs\").attr(\"d\", arc).style(\"fill\", trackColor).style(\"opacity\", (d, i) => {\n    return 0.3 / NUMSLICES * i;\n  }); // Create innerArcs data\n\n  const innerArcs = createInnerArcs(width, trackVolume); // Draw innerArcs\n\n  circle.selectAll(\".innerArcs\").data(innerArcs).enter().append(\"path\").attr(\"class\", \"innerArcs\").attr(\"d\", arc).style(\"fill\", trackColor).style(\"opacity\", (d, i) => {\n    return 1 / NUMSLICES * i;\n  });\n  circle.append(\"line\").attr(\"x1\", 0).attr(\"y1\", 0).attr(\"x2\", 0).attr(\"y2\", -(width / 30 * trackVolume + width / 350)).style(\"stroke\", trackColor).style(\"stroke-width\", 1.5); // Add animation to make the circle turn\n\n  const turnTimer = d3.timer(turn);\n\n  function turn(elapsed) {\n    const elapsedSeconds = elapsed / 1000 % duration;\n    const turnScale = d3.scaleLinear().range([1, 0]).domain([0, duration]);\n    circle.style(\"transform\", \"rotate(\".concat(-turnScale(elapsedSeconds), \"turn)\"));\n\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume\n    };\n  });\n}\n\nfunction createOuterArcs(width, trackVolume) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume * 2\n    };\n  });\n}","map":{"version":3,"sources":["/Users/dani/Antropoloops/atpls-player/src/visuals/drawCircle.ts"],"names":["d3","NUMSLICES","degreesFromSlice","scaleLinear","range","domain","deg2rad","degrees","Math","PI","drawCircle","parent","width","cx","cy","clip","duration","audio","durationSeconds","trackColor","color","trackVolume","volume","circlesGroup","append","attr","circle","arc","outerArcs","createOuterArcs","selectAll","data","enter","style","d","i","innerArcs","createInnerArcs","turnTimer","timer","turn","elapsed","elapsedSeconds","turnScale","select","empty","stop","map","startAngle","endAngle","innerRadius","outerRadius"],"mappings":"AAAA,OAAO,KAAKA,EAAZ,MAAoB,IAApB;AAIA;AACA,MAAMC,SAAS,GAAG,EAAlB,C,CAEA;;AACA,MAAMC,gBAAgB,GAAGF,EAAE,CACxBG,WADsB,GAEtBC,KAFsB,CAEhB,CAAC,CAAD,EAAI,GAAJ,CAFgB,EAEN;AAFM,CAGtBC,MAHsB,CAGf,CAAC,CAAD,EAAIJ,SAAJ,CAHe,CAAzB,C,CAKA;;AACA,MAAMK,OAAO,GAAIC,OAAD,IAAqBA,OAAO,IAAIC,IAAI,CAACC,EAAL,GAAU,GAAd,CAA5C;;AAEA,eAAe,SAASC,UAAT,CAAoBC,MAApB,EAAyCC,KAAzC,EAAwDC,EAAxD,EAAoEC,EAApE,EAAgFC,IAAhF,EAA4F;AACzG,QAAMC,QAAQ,GAAGD,IAAI,CAACE,KAAL,CAAWC,eAA5B;AACA,QAAMC,UAAU,GAAGJ,IAAI,CAACK,KAAxB;AACA,QAAMC,WAAW,GAAGN,IAAI,CAACE,KAAL,CAAWK,MAA/B;AACA,QAAMC,YAAY,GAAGZ,MAAM,CAACa,MAAP,CAAc,GAAd,EAAmBC,IAAnB,CAAwB,OAAxB,EAAiC,aAAjC,EAAgDA,IAAhD,CAAqD,WAArD,sBAA+EZ,EAA/E,eAAsFC,EAAtF,OAArB,CAJyG,CAMzG;;AACA,QAAMY,MAAM,GAAGH,YAAY,CAACC,MAAb,CAAoB,GAApB,EAAyBC,IAAzB,CAA8B,OAA9B,EAAuC,QAAvC,CAAf,CAPyG,CASzG;;AACA,QAAME,GAAG,GAAG3B,EAAE,CAAC2B,GAAH,EAAZ,CAVyG,CAYzG;;AACA,QAAMC,SAAS,GAAGC,eAAe,CAACjB,KAAD,EAAQS,WAAR,CAAjC,CAbyG,CAezG;;AACAK,EAAAA,MAAM,CACHI,SADH,CACa,YADb,EAEGC,IAFH,CAEQH,SAFR,EAGGI,KAHH,GAIGR,MAJH,CAIU,MAJV,EAKGC,IALH,CAKQ,OALR,EAKiB,WALjB,EAMGA,IANH,CAMQ,GANR,EAMaE,GANb,EAOGM,KAPH,CAOS,MAPT,EAOiBd,UAPjB,EAQGc,KARH,CAQS,SART,EAQoB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC1B,WAAO,MAAMlC,SAAN,GAAkBkC,CAAzB;AACD,GAVH,EAhByG,CA4BzG;;AACA,QAAMC,SAAS,GAAGC,eAAe,CAACzB,KAAD,EAAQS,WAAR,CAAjC,CA7ByG,CA+BzG;;AACAK,EAAAA,MAAM,CACHI,SADH,CACa,YADb,EAEGC,IAFH,CAEQK,SAFR,EAGGJ,KAHH,GAIGR,MAJH,CAIU,MAJV,EAKGC,IALH,CAKQ,OALR,EAKiB,WALjB,EAMGA,IANH,CAMQ,GANR,EAMaE,GANb,EAOGM,KAPH,CAOS,MAPT,EAOiBd,UAPjB,EAQGc,KARH,CAQS,SART,EAQoB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC1B,WAAO,IAAIlC,SAAJ,GAAgBkC,CAAvB;AACD,GAVH;AAYAT,EAAAA,MAAM,CACHF,MADH,CACU,MADV,EAEGC,IAFH,CAEQ,IAFR,EAEc,CAFd,EAGGA,IAHH,CAGQ,IAHR,EAGc,CAHd,EAIGA,IAJH,CAIQ,IAJR,EAIc,CAJd,EAKGA,IALH,CAKQ,IALR,EAKc,EAAEb,KAAK,GAAG,EAAR,GAAaS,WAAb,GAA2BT,KAAK,GAAG,GAArC,CALd,EAMGqB,KANH,CAMS,QANT,EAMmBd,UANnB,EAOGc,KAPH,CAOS,cAPT,EAOyB,GAPzB,EA5CyG,CAqDzG;;AACA,QAAMK,SAAS,GAAGtC,EAAE,CAACuC,KAAH,CAASC,IAAT,CAAlB;;AAEA,WAASA,IAAT,CAAcC,OAAd,EAA+B;AAC7B,UAAMC,cAAc,GAAID,OAAO,GAAG,IAAX,GAAmBzB,QAA1C;AACA,UAAM2B,SAAS,GAAG3C,EAAE,CAACG,WAAH,GAAiBC,KAAjB,CAAuB,CAAC,CAAD,EAAI,CAAJ,CAAvB,EAA+BC,MAA/B,CAAsC,CAAC,CAAD,EAAIW,QAAJ,CAAtC,CAAlB;AACAU,IAAAA,MAAM,CAACO,KAAP,CAAa,WAAb,mBAAoC,CAACU,SAAS,CAACD,cAAD,CAA9C;;AACA,QAAI1C,EAAE,CAAC4C,MAAH,CAAU,SAAV,EAAqBC,KAArB,EAAJ,EAAkC;AAChCP,MAAAA,SAAS,CAACQ,IAAV;AACD;AACF;;AAED,SAAOvB,YAAP;AACD;;AAED,SAASc,eAAT,CAAyBzB,KAAzB,EAAwCS,WAAxC,EAA6D;AAC3D,SAAOrB,EAAE,CAACI,KAAH,CAASH,SAAT,EAAoB8C,GAApB,CAAwB,CAACb,CAAD,EAAIC,CAAJ,KAAU;AACvC,WAAO;AACLa,MAAAA,UAAU,EAAE1C,OAAO,CAACJ,gBAAgB,CAACgC,CAAD,CAAjB,CADd;AAELe,MAAAA,QAAQ,EAAEd,CAAC,KAAKlC,SAAS,GAAG,CAAlB,GAAsBK,OAAO,CAACJ,gBAAgB,CAACgC,CAAC,GAAG,CAAL,CAAjB,CAA7B,GAAyD5B,OAAO,CAACJ,gBAAgB,CAACgC,CAAC,GAAG,CAAL,CAAjB,CAFrE;AAGLgB,MAAAA,WAAW,EAAE,CAHR;AAILC,MAAAA,WAAW,EAAEvC,KAAK,GAAG,EAAR,GAAaS;AAJrB,KAAP;AAMD,GAPM,CAAP;AAQD;;AAED,SAASQ,eAAT,CAAyBjB,KAAzB,EAAwCS,WAAxC,EAA6D;AAC3D,SAAOrB,EAAE,CAACI,KAAH,CAASH,SAAT,EAAoB8C,GAApB,CAAwB,CAACb,CAAD,EAAIC,CAAJ,KAAU;AACvC,WAAO;AACLa,MAAAA,UAAU,EAAE1C,OAAO,CAACJ,gBAAgB,CAACgC,CAAD,CAAjB,CADd;AAELe,MAAAA,QAAQ,EAAEd,CAAC,KAAKlC,SAAS,GAAG,CAAlB,GAAsBK,OAAO,CAACJ,gBAAgB,CAACgC,CAAC,GAAG,CAAL,CAAjB,CAA7B,GAAyD5B,OAAO,CAACJ,gBAAgB,CAACgC,CAAC,GAAG,CAAL,CAAjB,CAFrE;AAGLgB,MAAAA,WAAW,EAAE,CAHR;AAILC,MAAAA,WAAW,EAAEvC,KAAK,GAAG,EAAR,GAAaS,WAAb,GAA2B;AAJnC,KAAP;AAMD,GAPM,CAAP;AAQD","sourcesContent":["import * as d3 from \"d3\";\nimport { D3Selection } from \"./visuals\";\nimport { Clip } from \"../Audioset\";\n\n// Number of slices in a circle\nconst NUMSLICES = 36;\n\n// Scale. Get the degrees for a specific slice\nconst degreesFromSlice = d3\n  .scaleLinear()\n  .range([0, 360]) // working in degrees\n  .domain([0, NUMSLICES]);\n\n// Transform degrees into radians\nconst deg2rad = (degrees: number) => degrees * (Math.PI / 180);\n\nexport default function drawCircle(parent: D3Selection, width: number, cx: number, cy: number, clip: Clip) {\n  const duration = clip.audio.durationSeconds;\n  const trackColor = clip.color;\n  const trackVolume = clip.audio.volume;\n  const circlesGroup = parent.append(\"g\").attr(\"class\", \"circleGroup\").attr(\"transform\", `translate(${cx}, ${cy})`);\n\n  // We need to group again, so that the circle turns in its location\n  const circle = circlesGroup.append(\"g\").attr(\"class\", \"circle\");\n\n  // Arc generator\n  const arc = d3.arc();\n\n  // Create outerArcs data\n  const outerArcs = createOuterArcs(width, trackVolume);\n\n  // Draw outerArcs\n  circle\n    .selectAll(\".outerArcs\")\n    .data(outerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"outerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return 0.3 / NUMSLICES * i;\n    });\n\n  // Create innerArcs data\n  const innerArcs = createInnerArcs(width, trackVolume);\n\n  // Draw innerArcs\n  circle\n    .selectAll(\".innerArcs\")\n    .data(innerArcs)\n    .enter()\n    .append(\"path\")\n    .attr(\"class\", \"innerArcs\")\n    .attr(\"d\", arc)\n    .style(\"fill\", trackColor)\n    .style(\"opacity\", (d, i) => {\n      return 1 / NUMSLICES * i;\n    });\n\n  circle\n    .append(\"line\")\n    .attr(\"x1\", 0)\n    .attr(\"y1\", 0)\n    .attr(\"x2\", 0)\n    .attr(\"y2\", -(width / 30 * trackVolume + width / 350))\n    .style(\"stroke\", trackColor)\n    .style(\"stroke-width\", 1.5);\n\n  // Add animation to make the circle turn\n  const turnTimer = d3.timer(turn);\n\n  function turn(elapsed: number) {\n    const elapsedSeconds = (elapsed / 1000) % duration;\n    const turnScale = d3.scaleLinear().range([1, 0]).domain([0, duration]);\n    circle.style(\"transform\", `rotate(${-turnScale(elapsedSeconds)}turn)`);\n    if (d3.select(\".circle\").empty()) {\n      turnTimer.stop();\n    }\n  }\n\n  return circlesGroup;\n}\n\nfunction createInnerArcs(width: number, trackVolume: number) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume,\n    };\n  });\n}\n\nfunction createOuterArcs(width: number, trackVolume: number) {\n  return d3.range(NUMSLICES).map((d, i) => {\n    return {\n      startAngle: deg2rad(degreesFromSlice(d)),\n      endAngle: i === NUMSLICES - 1 ? deg2rad(degreesFromSlice(d + 1)) : deg2rad(degreesFromSlice(d + 2)),\n      innerRadius: 0,\n      outerRadius: width / 30 * trackVolume * 2,\n    };\n  });\n}\n"]},"metadata":{},"sourceType":"module"}